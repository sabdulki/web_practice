/*! JAC 1.5.0, Copyright 2018-2022 Yahoo Inc. */(()=>{var e={835:()=>{"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),s=1;s<arguments.length;s++){var n=arguments[s];if(null!=n)for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i[o]=n[o])}return i},writable:!0,configurable:!0})},231:()=>{String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e})},570:()=>{function e(e,t){return void 0===t&&(t=0),this.indexOf(e,t)>=0}String.prototype.includes||(String.prototype.includes=e),Array.prototype.includes||(Array.prototype.includes=e)}},t={};function i(s){var n=t[s];if(void 0!==n)return n.exports;var o=t[s]={exports:{}};return e[s](o,o.exports,i),o.exports}(()=>{"use strict";i(570),i(835),i(231);const e=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.type=e,this.meta=t,this.target=null}};class t extends e{static SCROLL="page.scroll";static RESIZE="page.resize";static VISIBILITY="page.visibility";static FOCUS="window.focus";static BLUR="window.blur";static FOCUS_IN="window.focus_in";static BLUR_CAPTURE="window.blur_capture";static DOM_LOADED="dom.loaded";static LOADED="page.loaded";static BEFORE_UNLOAD="page.stopped";static MOUSE_OVER="page.mouse_over";static MOUSE_OUT="page.mouse_out"}const s={addDOMLoadListener:function(e){if("loading"!==document.readyState)return e();document.addEventListener("DOMContentLoaded",e,!1)},addPageLoadListener:function(e){if("complete"===document.readyState)return e();window.addEventListener("load",e,!1)}};function n(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,s=null,n=null;const o=()=>{e.apply(i,n),s=null};return function(){if(!s){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];n=i,s=setTimeout(o,t)}}}function o(e,t){if(Array.isArray(t)){if(t.includes(e))return!0}else for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&t[i]===e)return!0;return!1}const r="function",a="number",c="object",l="string",d="undefined";function h(e){return typeof e!==d}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,n=Number.NaN;return typeof e===a?n=e:typeof e===l&&(n=Number(e),isNaN(n)&&(n=parseFloat(e))),isNaN(n)||h(i)&&n<i||h(s)&&n>s?t:n}const g={isSet:h,isFunction:function(e){return typeof e===r},isString:function(e){return typeof e===l},isObject:function(e){return typeof e===c},num:u,int:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;const n=u(e,t,i,s);return typeof n!==a||isNaN(n)?t:Math.round(n)},isDOMNode:function(e){return e instanceof HTMLElement},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},isOldIE:function(e){return e.navigator.userAgent.includes("Trident/")}};function p(){try{for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];console.log.apply(console,[].slice.call(t))}catch(e){}}const m="exists",E="remove",f={on(e,t,i){this.eventTypes||(this.eventTypes={}),this.eventTypes[e]||(this.eventTypes[e]=[]),o(t,this.eventTypes[e])||(i?this.eventTypes[e].push({ref:i,handler:t}):this.eventTypes[e].push(t))},off(e,t,i){this.eventTypes&&Array.isArray(this.eventTypes[e])&&this._validateOrRemove.call(this,e,t,i,E)},hasEventListener(e,t,i){return!(!this.eventTypes||!Array.isArray(this.eventTypes[e]))&&this._validateOrRemove.call(this,e,t,i,m)},trigger(e){if(this.eventTypes&&typeof e===c&&typeof e.type===l&&this.eventTypes[e.type]){e.target=e.target||this;let t=this.eventTypes[e.type].slice(0);for(let i=0;i<t.length;i++){const s=t[i];if(typeof s===c)try{s.handler.call(s.ref,e)}catch(t){p("Error calling callback",s,e,t)}else try{s(e)}catch(t){p("Error calling callback",e,t)}}}},_validateOrRemove(e,t,i,s){for(let n=0;n<this.eventTypes[e].length;n++){let o=this.eventTypes[e][n],a=i?c:r;if(a===typeof o)switch(a){case r:if(o===t)return s===E&&this.eventTypes[e].splice(n,1),!0;break;case c:if(o.handler===t&&o.ref===i)return s===E&&this.eventTypes[e].splice(n,1),!0}}return!1}};class _{#e=!1;#t=!1;#i=!1;#s;#n;constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{throttleTime:200};s.addDOMLoadListener((()=>{this.#e=!0,this.trigger(new t(t.DOM_LOADED))})),s.addPageLoadListener((()=>{this.#t=!0,this.#n=(new Date).getTime(),this.trigger(new t(t.LOADED,{timestamp:this.#n}))}));const i=e.throttleTime;window.addEventListener("scroll",n((()=>this.dispatchViewportEvent(t.SCROLL)),i),!0),window.addEventListener("resize",n((()=>this.dispatchViewportEvent(t.RESIZE)),i)),document.addEventListener("visibilitychange",(()=>this.dispatchVisibilityChange())),this.#i=!window.document.hidden,window.addEventListener("focus",(e=>this.dispatchFocusChange(!0,e))),window.addEventListener("blur",(e=>this.dispatchFocusChange(!1,e))),this.#s=document.hasFocus(),window.addEventListener("beforeunload",(()=>this.trigger(new t(t.BEFORE_UNLOAD)))),window.document.addEventListener("mouseover",(e=>this.trigger(new t(t.MOUSE_OVER,{nativeEvent:e})))),window.document.addEventListener("mouseout",(e=>this.trigger(new t(t.MOUSE_OUT,{nativeEvent:e})))),window.addEventListener("focusin",(e=>this.trigger(new t(t.FOCUS_IN,{nativeEvent:e})))),window.addEventListener("blur",(e=>this.trigger(new t(t.BLUR_CAPTURE,{nativeEvent:e}))),!0)}on=function(e,i,s){Object.getPrototypeOf(this).on.call(this,e,i,s);let n,o=!1;if((e===t.DOM_LOADED&&this.domLoaded||e===t.LOADED&&this.pageLoaded||e===t.VISIBILITY)&&(o=!0),o)if(n=e===t.VISIBILITY?new t(t.VISIBILITY,{hidden:!!window.document.hidden}):e===t.DOM_LOADED?new t(t.DOM_LOADED):new t(t.LOADED,{timestamp:this.#n}),s)try{i.call(s,n)}catch(e){p("Error calling callback",i,event)}else i(n)};dispatchViewportEvent(e){this.trigger(new t(e))}dispatchVisibilityChange(){this.#i=!window.document.hidden,this.trigger(new t(t.VISIBILITY,{hidden:!this.#i}))}dispatchFocusChange(e,i){if(this.#s!==e){this.#s=e;const s=e?t.FOCUS:t.BLUR;this.trigger(new t(s,{nativeEvent:i}))}}get domLoaded(){return this.#e}get pageLoaded(){return this.#t}get isVisible(){return this.#i}get hasFocus(){return this.#s}_reset(){this.#e=!1,this.#t=!1}}Object.assign(_.prototype,f);const A=_;class C{static topic={WRITE_COMPLETE:"jac.sandbox.writeComplete",PAGE_LOAD:"jac.sandbox.pageLoad",SIZE:"jac.sandbox.size",UNLOAD:"jac.sandbox.unload",CLOSE_AD:"jac.sandbox.closeAd",CONFIG:"jac.sandbox.config"};constructor(e){let{topic:t,meta:i={}}=e;this.topic=t,this.meta=i}}function w(e,t,i,s){const n=document.createElement("div");t=(t-=2)<66?66:t,n.style.cssText=`top:0;right:0;font-size:12px;user-select:none;border-color:#e2e2e2;font-family:Helevetica Neue,Arial,sans-serif;color:#000;height:24px;display:block;min-width:66px;max-width:${t}px;white-space:nowrap;z-index:214748366;position:absolute;border-style:solid;width:auto;cursor:pointer;border-width:1px;`+i;const o=`<span style="position:absolute;right:0;font-size:20px;width:19px;top:2px;line-height:20px;border-left:1px solid black;margin-left:5px;">${s}</span>`;return n.innerHTML=`<span style="position:relative;padding:5px 26px 5px 10px;text-align:center;display:block;width:auto;height:auto;overflow:hidden;text-overflow: ellipsis;" title="${e}">${e}${o}</span>`,n}const O=class{static createCloseAdButton(e,t){return w(e,t,"border-color:#e2e2e2;border-bottom-left-radius:6px;background-color:#e2e2e2;","&times;")}static createOpenAdButton(e,t){const i=w(e,t,"background:#fff;border-color:#000;border-radius:4px;","&plus;");return i.className="jac-show-ad",i}static createPlaceholderSvg(e){return`<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><rect width="100%" height="100%" fill="${e.backgroundColor}"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="${e.textColor}" font-family="Arial, Helvetica, sans-serif" font-size="${e.fontSize}">`+e.text+"</text></svg>"}},v="jac_close";const S={updateAdDisplay(e,t,i){const s=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:window).document,n=e.client.closeButton.enabledForSizes,o=`${t.width}x${t.height}`;let r=!0;Array.isArray(n)&&!n.includes(o)&&(r=!1);const a=s.getElementById(v);a&&a.parentNode.removeChild(a),e.client.closeButton.enabled&&r&&function(e){let{document:t,closeLabel:i,maxWidth:s,closeHandler:n}=e;const o=O.createCloseAdButton(i,s);o.setAttribute("id",v),o.addEventListener("click",n,!1),t.body.appendChild(o)}({document:s,closeLabel:e.client.closeButton.labels.close,maxWidth:t.width,closeHandler:()=>{i.send(new C({topic:C.topic.CLOSE_AD,meta:{closeConfig:e.client.closeButton,adSize:{width:t.width}}}))}})}};class T extends C{static topic={SAFE_FRAME:"jac.sandbox.sf"};static cmd={EXPAND_OVER:"exp-ovr",EXPAND_PUSH:"exp-push",RESIZE_TO:"resize-to",COLLAPSE:"collapse",READ_COOKIE:"read-cookie",WRITE_COOKIE:"write-cookie",MSG:"msg",HIDE:"hide",SHOW:"show"};static status={COLLAPSED:"collapsed",COLLAPSING:"collapsing",EXPANDED:"expanded",EXPANDING:"expanding",RESIZE_TO:"resize-to",GEOMETRY_UPDATE:"geom-update",FOCUS_CHANGE:"focus-change",READ_COOKIE:"read-cookie",WRITE_COOKIE:"write-cookie",FAILED:"failed",CMP:"cmp",MSG:"msg",META_UPDATE:"meta-update",HIDE:"hide",SHOW:"show",REGISTER:"register"};constructor(e){let{cmd:t=null,status:i=null,meta:s={}}=e;super({topic:T.topic.SAFE_FRAME,meta:s}),this.cmd=t,this.status=i}}class b extends e{constructor(e){super(e.topic),this.message=e}}class D{#o;#r;#a;constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.#o=t,this.targetWindow=e,this.#a=i,Object.keys(i).forEach((e=>{(i[e].before||[]).concat(i[e].after||[]).forEach((e=>{i[e]=i[e]||{}}))}))}_sendBulkMessages(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((e=>this.#a[e])).forEach((e=>{this.send(new C({topic:e})),delete this.#a[e]}))}send(e){const t=this.#a[e.topic];delete this.#a[e.topic],t&&this._sendBulkMessages(t.before),this.targetWindow.postMessage(Object.assign({token:this.#o},e),"*"),t&&this._sendBulkMessages(t.after)}listen(){this.#r||(this.#r=e=>this._handlePostMessage(e),window.addEventListener("message",this.#r))}cleanup(){window.removeEventListener("message",this.#r),this.#r=null}_handlePostMessage(e){if(this._shouldReadPostMessage(e)){const t=new(e.data.topic===T.topic.SAFE_FRAME?T:C)(e.data),i=new b(t);this.trigger(i)}}_shouldReadPostMessage(e){return e.source===this.targetWindow&&e.data&&e.data.token===this.#o&&e.data.topic}}Object.assign(D.prototype,f);const R=D;const P={setStyles:function(e,t){Object.keys(t).forEach((i=>{void 0!==t[i]&&(e.style[i]=t[i])}))},getComputedStyle:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;const s=i.getComputedStyle(e);return t?s.getPropertyValue(t):s}},y="hidden",I="scroll",L="auto";function N(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;const t=e,i=document.documentElement,s=t.innerWidth||i.clientWidth||0,n=t.innerHeight||i.clientHeight||0,o=t.screenLeft||t.screenX||0,r=o+s,a=t.screenTop||t.screenY||0,c=a+n;return{top:a,left:o,bottom:c,right:r,width:s,height:n}}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window,{left:i,right:s,top:n,bottom:o}=e.getBoundingClientRect()||{};e===t.document.body&&o<t.innerHeight&&(o=t.innerHeight),e===t.document.body&&s<t.innerWidth&&(s=t.innerWidth);const r=P.getComputedStyle(e,"z-index",t),a=s-i,c=o-n;return{left:i,right:s,top:n,bottom:o,width:a,height:c,zIndex:r}}function M(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;const t=e.document;return F(t)?t.documentElement:t.body}function F(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;return"CSS1Compat"===e.compatMode&&e.documentElement}const U={getWindowGeometry:N,getElementGeometry:x,getVisibilityMetrics:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;const{width:i,height:s}=N(t),n=x(e,t),o=n.width*n.height;n.width=n.width||1,n.height=n.height||1;const r=n.top>n.bottom;let a,c;if(n.right<=0||n.left>i)a=0;else{const e=Math.max(-n.left,0),t=Math.max(n.right-i,0);a=n.width-e-t}if(r&&n.bottom<=0||n.top>s)c=0;else{const e=Math.max(-n.top,0),t=Math.max(n.bottom-s,0);c=n.height-e-t}const l=a*c/(o||1);return{containerPixels:o,xPercentage:a/n.width,yPercentage:c/n.height,totalPercentage:Math.min(l,1)}},isClippingElement:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"X",i=arguments.length>2?arguments[2]:void 0;i=i||P.getComputedStyle(e);const s=i["overflow"+t],n=i.overflow;return s===y||s===I||s===L||n===y||n===I||n===L},isScrollableElement:function(e,t){const i=(t=t||P.getComputedStyle(e)).overflowX,s=t.overflowY,n=t.overflow,o=i===I||n===I||(i===L||n===L)&&e.scrollWidth>e.clientWidth,r=s===I||n===I||(s===L||n===L)&&e.scrollHeight>e.clientHeight;return o||r},getPageScrollInfo:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;const t=M(e);return{x:Math.max(t.scrollLeft,0),y:Math.max(t.scrollTop,0),w:Math.max(t.scrollWidth,0),h:Math.max(t.scrollHeight,0)}},getDocumentElement:M};const k=class{static isMobileMomentAd(e){return!!e&&!!e.meta&&"MobileMoments"===e.meta.GoldenFormat}static computeDisplaySize(e){const t={width:300,height:533},i=U.getWindowGeometry();return e.config.client.mobileMoments.enabled&&i.width<=550&&i.width<i.height&&(t.width=i.width,t.height=Math.floor(1.7777777777777777*i.width)),t}};class z extends e{static INIT_CALLED="SandboxApi.INIT_CALLED"}const G={clone(e){return e.map((e=>Array.isArray(e)?this.clone(e):"object"==typeof e?j.copy(e,{}):e))},diff:(e,t)=>e.filter((e=>-1===t.indexOf(e))),isSubset(e,t){return this.diff(e,t).length<=0},remove(e,t){const i=e.indexOf(t);i>=0&&e.splice(i,1)},removeDuplicates:e=>e.filter(((t,i)=>e.indexOf(t)===i))},j={clone(e){return this.copy(e,{})},copy(e,t,i){return Object.keys(e).forEach((s=>{const n=e[s];g.isDOMNode(n)?i&&g.isSet(t[s])||(t[s]=n):g.isObject(n)&&null!==n&&!Array.isArray(n)?(t[s]=t[s]||{},this.copy(e[s],t[s],i)):i&&g.isSet(t[s])||(t[s]=Array.isArray(n)?G.clone(n):n)})),t},removeEmptyItems(e){return Object.keys(e).forEach((t=>{const i=e[t];if(i&&g.isObject(i)){this.removeEmptyItems(i);0===Object.keys(i).length&&delete e[t]}else(i&&Array.isArray(i)&&0===i.length||g.isString(i)&&!i)&&delete e[t]})),e}};class V{#c;#l;#d;#h;constructor(e,t){this.#c=e,this.#l=t.service.sizes||[],this.#h=j.clone(t.client.flexible),this.#d=this.#h.enabled&&(this.#h.width.enabled||this.#h.height.enabled)}init(e){let{w:t,h:i,ratio:s,config:n}=e,o=this.#l.includes(`${t}x${i}`),r=null;o&&!this.#d?r={width:t,height:i}:s&&(this.#h.enabled||this.#h.enabledByAds)&&(o=!0,r={ratio:s},this.#d=!0),n&&this.#c.send(new C({topic:C.topic.CONFIG,meta:n})),r&&this.#c.send(new C({topic:C.topic.SIZE,meta:r})),o&&this.trigger(new z(z.INIT_CALLED,r))}unload(){this.#c.send(new C({topic:C.topic.UNLOAD}))}}Object.assign(V.prototype,f);const H=V,B={fromSafeFrameConfigToCmdSupportMap(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).features||{};return{"exp-ovr":!(!e.expandOver||!e.expandOver.enabled),"exp-push":!(!e.expandPush||!e.expandPush.enabled),"read-cookie":!(!e.cookies||!e.cookies.read),"write-cookie":!(!e.cookies||!e.cookies.write),"resize-to":!(!e.resize||!e.resize.enabled)}}},$=/^(\d+)x(\d+)$/,W={isSize:e=>e&&e.match($),toSize(e){const t={width:0,height:0},i=e.match($);return i&&(t.width=parseInt(i[1]),t.height=parseInt(i[2])),t}},Z={getParameter(e,t){t=t.replace(/[[\]]/g,"\\$&");const i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},getParameters(e,t){return t.reduce(((t,i)=>{const s=this.getParameter(e,i);return s&&(t[i]=s),t}),{})},removeParameters:e=>e&&"string"==typeof e?e.split(/[?#]/)[0]:""};let J=30;function Y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;const t=Z.getParameter(e.location.href,"jac.debug");"1"===t&&(J=10)}const X={init(){Y(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window)},debug(){J<=10&&console.debug.apply(console,arguments)},info(){J<=20&&console.info.apply(console,arguments)},warning(){J<=30&&console.warn.apply(console,arguments)},error(){J<=40&&console.error.apply(console,arguments)}};Y();const q={NOT_SUPPORTED:"Feature not supported by the host.",NOT_REGISTERED:"No prior $sf.ext.register() API call.",EXPANDED:"Already expanded.",NOT_EXPANDED:"Not expanded.",COMMAND_PENDING:"Command already in-progress.",INVALID_COOKIE_ARGS:"Invalid cookie arguments.",INVALID_ARGS:"Invalid arguments.",INVALID_SIZE:"Setting size to less than 1px is hiding, call $sf.ext.hide instead.",SIZE_CONSTRAINTS_ERROR:"Setting size to a value bigger than the allowed constraints.",INVALID_HIDDEN_SIZE:"Setting size must be greater than 15 if SafeFrame has been hidden.",MISSING_RESIZE_FLEXIBLE_RATIO:"Flexible safeframes can only be resized by ratio.",NOT_ALLOWED_FLEXIBLE_EXPAND:"Flexible safeframe expansion is not supported."},K={COLLAPSED:"collapsed",COLLAPSING:"collapsing",EXPANDED:"expanded",EXPANDING:"expanding",RESIZING:"resizing",HIDDEN:"hidden"};class Q{messenger;windowContext;sizesConfig;hasRegistered=!1;pendingCommand=null;alignmentElement;statusUpdateCallback;supportsMap;geomData;hasFocus;metaData;registrationKey;width;height;flexibleConfig={};isFlexible;_status=K.COLLAPSED;initSandboxCalled=!1;sizeConstraints;static FailureReason=q;constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window;this.messenger=e,this.windowContext=s,this.sizesConfig=t.service.sizes||[];const n=t.client.safeFrame;this.supportsMap=B.fromSafeFrameConfigToCmdSupportMap(n),e.on(T.topic.SAFE_FRAME,this._onSafeFrameMessage,this),i=i||{},i.geom&&(this.geomData=i.geom),i.focus&&(this.hasFocus=i.focus),this.metaData=i.meta||{},this.flexibleConfig=t.client.flexible,this.isFlexible=this.flexibleConfig.enabled,this.sizeConstraints={width:n.width,height:n.height},s.JAC.sandbox.on(z.INIT_CALLED,(e=>{this.initSandboxCalled=!0,e.meta&&e.meta.ratio&&(this.isFlexible=!0)}))}_sendMessage(e){let{cmd:t,meta:i}=e;this.messenger.send(new T({cmd:t,meta:i})),this.pendingCommand=t}_onSafeFrameMessage(e){const{status:t,meta:i}=e.message;if(o(t,T.status)){if(this.pendingCommand===i.cmd&&(this.pendingCommand=null,t===T.status.FAILED))switch(i.cmd){case T.cmd.EXPAND_OVER:case T.cmd.EXPAND_PUSH:case T.cmd.RESIZE_TO:this._status=K.COLLAPSED;break;case T.cmd.COLLAPSE:this._status=K.EXPANDED}this._callStatusUpdate(t,i)}}register(e,t,i){if(this.hasRegistered)X.error("$sf.ext.register() can be called only once and has been called already.");else{if(this.hasRegistered=!0,g.isFunction(i)&&(this.statusUpdateCallback=i),this.initSandboxCalled)X.warning(`${e}x${t} size is ignored as size was set already.`);else{if(this.sizesConfig.includes(`${e}x${t}`)&&!this.isFlexible){const i=g.int(e,0,0),s=g.int(t,0,0);this.messenger.send(new C({topic:C.topic.SIZE,meta:{width:i,height:s}})),this.width=i,this.height=s}}this.registrationKey={},this._callStatusUpdate(T.status.REGISTER,{key:this.registrationKey})}}_width(){return g.isSet(this.width)||(this.width=U.getWindowGeometry().width),this.width}_height(){return g.isSet(this.height)||(this.height=U.getWindowGeometry().height),this.height}_isValidSize(e,t){const i=!this.sizeConstraints.width||!this.sizeConstraints.width.max||e<=this.sizeConstraints.width.max,s=!this.sizeConstraints.height||!this.sizeConstraints.height.max||t<=this.sizeConstraints.height.max;return i&&s}_callStatusUpdate(e,t){let{cmd:i,reason:s,info:n,key:r}=t;if(e===T.status.FAILED?X.warning("SafeFrame: command failed",{cmd:i,reason:s,info:n}):e===T.status.META_UPDATE?this.metaData=n:e===T.status.GEOMETRY_UPDATE?this.geomData=n:e===T.status.FOCUS_CHANGE?this.hasFocus=n:e===T.status.RESIZE_TO?(this.width=n.w,this.height=n.h,this._status=K.COLLAPSED):o(e,K)&&(e===T.status.COLLAPSED&&this._align(),this._status=e),this.statusUpdateCallback){const t={cmd:i,reason:s,info:n};r&&(t.key=r),this.statusUpdateCallback.call(this,e,t)}}_sendFailureStatus(e,t){this._callStatusUpdate(T.status.FAILED,{cmd:e,reason:t})}supports(e){return g.isSet(e)?!!this.supportsMap[e]:this.supportsMap}expand(e){let{t,l:i,r:s,b:n,push:o}=e;const r=o?T.cmd.EXPAND_PUSH:T.cmd.EXPAND_OVER;let a;this.supports(r)?this.hasRegistered?this.pendingCommand?a=q.COMMAND_PENDING:this.status()===K.EXPANDED?a=q.EXPANDED:this.isFlexible&&(a=q.NOT_ALLOWED_FLEXIBLE_EXPAND):a=q.NOT_REGISTERED:a=q.NOT_SUPPORTED;const c={top:g.int(t,0,0),left:g.int(i,0,0),right:g.int(s,0,0),bottom:g.int(n,0,0)},l=this._width()+c.left+c.right,d=this._height()+c.top+c.bottom;this._isValidSize(l,d)||(a=q.SIZE_CONSTRAINTS_ERROR),a?this._sendFailureStatus(r,a):(this._align(c),this._sendMessage({cmd:r,meta:c}),this._status=K.EXPANDING)}collapse(){const e=T.cmd.COLLAPSE;let t;this.hasRegistered?this.pendingCommand?t=q.COMMAND_PENDING:this.status()!==K.EXPANDED&&(t=q.NOT_EXPANDED):t=q.NOT_REGISTERED,t?this._sendFailureStatus(e,t):(this._sendMessage({cmd:e}),this._status=K.COLLAPSING)}_align(){let{top:e,left:t,right:i,bottom:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.alignmentElement||(this.alignmentElement=this.windowContext.document.getElementById("fc_align"));const n={};e&&!s?(n.top=null,n.bottom="0"):(n.top="0",n.bottom=null),t&&!i?(n.left=null,n.right="0"):(n.left="0",n.right=null),P.setStyles(this.alignmentElement,n),this._adjustWindowContentSize()}_adjustWindowContentSize(){const e=this.windowContext.document.documentElement.style;e.width=e.height="100%"}cookie(e,t){const i=t?T.cmd.WRITE_COOKIE:T.cmd.READ_COOKIE;let s;this.supports(i)?this.hasRegistered?!e||t&&!t.value?s=q.INVALID_COOKIE_ARGS:this.pendingCommand&&(s=q.COMMAND_PENDING):s=q.NOT_REGISTERED:s=q.NOT_SUPPORTED,s?this._sendFailureStatus(i,s):this._sendMessage({cmd:i,meta:{cookieName:e,cookieData:t}})}meta(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"shared";const i=Object.prototype.hasOwnProperty,s=this.metaData;if(i.call(s,t)){const n=s[t];if(i.call(n,e))return n[e]}return""}status(){return this._status}geom(){return this.geomData}inViewPercentage(){if(this.geomData){const e=this.geomData.self.iv;return Math.round(100*e)}}winHasFocus(){return this.hasFocus}resizeTo(e){let t,i;const s=T.cmd.RESIZE_TO;let n;if(this.supports(T.cmd.RESIZE_TO)?g.isObject(e)?this.hasRegistered?this._status===K.EXPANDED?n=q.EXPANDED:this.pendingCommand?n=q.COMMAND_PENDING:this.isFlexible&&!W.isSize(e.ratio)&&(n=q.MISSING_RESIZE_FLEXIBLE_RATIO):n=q.NOT_REGISTERED:n=q.INVALID_ARGS:n=q.NOT_SUPPORTED,!n)if(t=g.int(e.w,this._width()),i=g.int(e.h,this._height()),t<=1||i<=1)n=q.INVALID_SIZE;else if(this._status===K.HIDDEN&&(t<=15||i<=15))n=q.INVALID_HIDDEN_SIZE;else{if(t===this.width&&i===this.height&&!this.isFlexible)return;this.isFlexible||this._isValidSize(t,i)||(n=q.SIZE_CONSTRAINTS_ERROR)}n?this._sendFailureStatus(s,n):(this._adjustWindowContentSize(),this._sendMessage({cmd:T.cmd.RESIZE_TO,meta:this.isFlexible?{ratio:e.ratio}:{width:t,height:i}}),this._status=K.RESIZING)}hide(e){this._status=K.HIDDEN}show(e){}ui(){const e={flex:0};return this.flexibleConfig.enabledByAds&&!this.isFlexible&&(e.flexCanBeActivated=!0),this.isFlexible&&(this.flexibleConfig.width.enabled&&this.flexibleConfig.height.enabled?e.flex="both":this.flexibleConfig.width.enabled?e.flex="w":this.flexibleConfig.height.enabled&&(e.flex="h")),e}}class ee{#u;constructor(e,t,i,s){this.#u=new Q(e,t,i,s)}register=(e,t,i)=>{this.#u.register(e,t,i)};supports=e=>this.#u.supports(e);expand=e=>{this.#u.expand(e)};collapse=()=>{this.#u.collapse()};cookie=(e,t)=>{this.#u.cookie(e,t)};meta=(e,t)=>this.#u.meta(e,t);status=()=>this.#u.status();geom=()=>this.#u.geom();inViewPercentage=()=>this.#u.inViewPercentage();winHasFocus=()=>this.#u.winHasFocus();resizeTo=e=>this.#u.resizeTo(e);hide=e=>this.#u.hide(e);show=e=>this.#u.show(e);msg=(e,t)=>{this.#u.msg(e,t)};ui=()=>this.#u.ui();hostURL(){return document.referrer}}class te{messenger;lastMessageSentTime;constructor(e){this.messenger=e}_sendMessage(e){let{cmd:t,meta:i}=e;this.messenger.send(new T({cmd:t,meta:i}))}msg(e){return!(this.lastMessageSentTime&&!(this.lastMessageSentTime<(new Date).getTime()-200))&&(this._sendMessage({cmd:T.cmd.MSG,meta:e}),this.lastMessageSentTime=(new Date).getTime(),!0)}}const ie={"1AS":"1AS",RAS:"RAS",SSP:"SSP",VZMSSP:"VZMSSP",PG:"PG",pointguard:"pointguard"},se="px",ne=1,oe=2,re=3,ae={SAFE_FRAME:"SF",NON_FRIENDLY_IFRAME:"NFIF",FRIENDLY_IFRAME:"FIF"},ce=0,le=1,de=2,he=3,ue=4,ge=5,pe={LB:["728x90","970x250"],RR:["300x250","300x600"],MM:["300x250","320x50"],LREC:["300x250"],MON:["300x600"],LDRB:["728x90"],MAST:["970x250"]};class me extends e{static CONFIG_UPDATE="Position.CONFIG_UPDATE";static ROTATION_UPDATE="Position.ROTATION_UPDATE";static META_UPDATE="Position.META_UPDATE"}const{SAFE_FRAME:Ee,NON_FRIENDLY_IFRAME:fe,FRIENDLY_IFRAME:_e}=ae;class Ae{#g;#p=!1;name;config;adData;fetch;render;constructor(e,t){if(!g.isString(e))throw new Error(`Invalid ${"name"} argument. String is expected`);this.name=e,this.update(t)}update(e){this.config=e,this.updateContainerType(),this.trigger(new me(me.CONFIG_UPDATE,this.config)),this.trigger(new me(me.ROTATION_UPDATE,this.config))}get containerType(){return this.#g}updateContainerType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.config.client,i=t.safeFrame,s=t.nonFriendlyIframe;s&&s.enabled?this.#g=fe:i&&i.enabled?this.#g="true"===e.friendlyIframe?_e:Ee:this.#g=_e}updateMeta(e,t,i){if(this.config.updateMeta(e,t,i)){const e=this.config.client.meta;this.trigger(new me(me.META_UPDATE,{adMeta:e}))}}resetRotation(){this.rotated=!1;const e=this.config.resetRotationConfig(),t=this.config.service;t.alias=t.params.origmn||t.alias,delete t.params.origmn,this.trigger(new me(me.CONFIG_UPDATE,this.config)),e&&this.trigger(new me(me.ROTATION_UPDATE,this.config))}updateRotationConfig(e){this.config.updateRotationConfig(e)&&(this.trigger(new me(me.CONFIG_UPDATE,this.config)),this.trigger(new me(me.ROTATION_UPDATE,this.config)))}set alias(e){if(!e)return;const t=this.config.service;if(t.alias!==e){const i=t.params.origmn||t.alias;i&&(t.params.origmn=i),t.alias=e,this.trigger(new me(me.CONFIG_UPDATE,this.config))}}get alias(){return this.config.service.alias}set rotated(e){this.#p=e}get rotated(){return this.#p}get hasMobileMomentsAd(){return k.isMobileMomentAd(this.adData)}applyAdData(e){this.adData=e,this.hasMobileMomentsAd&&(e.content.size=k.computeDisplaySize(this))}}let Ce;Object.assign(Ae.prototype,f);let we=!1;function Oe(e,t,i){const s=function(e,t){let i=e.document.referrer;if(!i&&De(e)&&(i=e.parent.location.href),!t||!i)return!1;const s=i.match(/^(https?:\/\/)?([^/?]*).*$/);if(!s||s.length<3)return!1;const n=s[2],o=["aol.com","yahoo.com","msn.com"].filter((e=>n.endsWith(e)));return t&&0===o.length&&X.error(`JAC nested iframes for domain ${n} are not supported.`),o.length>0}(t,i)?t.parent:t.top,n={[C.topic.UNLOAD]:{before:[C.topic.WRITE_COMPLETE],after:[]}};Ce=new R(s,e,n)}function ve(e){let{positionConfig:t,initialWidth:i,initialHeight:s,allowedSizes:n}=e;const o=t.client.sandbox.anchorTarget;if(Ce.send(new C({topic:C.topic.PAGE_LOAD})),we&&!t.client.flexible.enabled&&Te(i,s,n,t),S.updateAdDisplay(t,{width:i,height:s},Ce,window),o){const e=document.getElementsByTagName("a");for(let t=0;t<e.length;t++){e[t].setAttribute("target",o)}}}let Se=4e3;function Te(e,t,i,s){if(!we)return;const{scrollWidth:n,scrollHeight:o}=function(e){let t;return e.client.safeFrame.enabled&&(t=document.getElementById("fc_align")),t=t||document.body,{scrollWidth:t.scrollWidth,scrollHeight:t.scrollHeight}}(s);if(n>e||o>t){const{width:e,height:t}=function(e,t,i){const s=e*t;let n=1e5,o={};return i.forEach((e=>{const t=Math.abs(s-e.width*e.height);t<n&&(n=t,o=e)})),o}(n,o,i);Ce.send(new C({topic:C.topic.SIZE,meta:{width:e,height:t}})),S.updateAdDisplay(s,{width:e,height:t},Ce,window)}else Se>0&&(Se-=100,setTimeout((()=>{Te(e,t,i,s)}),100))}function be(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;const s=e.config;if(e.containerType===ae.SAFE_FRAME){const e=i.document.getElementById("fc_align");(s.client.flexible.enabled||t)&&e&&(e.style.width="100%")}}function De(e){let t=!1;try{e.parent.location.href&&(t=!0)}catch(e){t=!1}return t}const Re={service:{params:{}},client:{fetch:{auto:!0,minInterval:2e3,timeout:3e4,cacheTTL:6e4},render:{auto:!0,timeout:6e4,requireViewable:!1,doubleBuffering:!1,delayedLoadInLegacyIE:!1,abortOnFocus:!0,abortOnMouseOver:!1,abortOnExpandedAd:!0,useConfigSize:!1},layout:{zIndex:10},rotation:{enabled:!1,period:2e4,limit:20,requireViewable:!0,inViewDuration:1e3,resizable:!1,cancellable:!0,onNoAd:!1},nonFriendlyIframe:{enabled:!1},safeFrame:{enabled:!0,features:{expandOver:{enabled:!0},expandPush:{enabled:!1},resize:{enabled:!1},cookies:{read:!1,write:!1,allowed:["CRZY"]}}},sandbox:{baseUrl:null,uniqueDomain:!1,anchorTarget:"_blank",features:{fullscreen:{enabled:!0},autoplay:{enabled:!0},geolocation:{enabled:!1},camera:{enabled:!1},microphone:{enabled:!1}},allow:["forms","scripts","same-origin","popups","popups-to-escape-sandbox"]},nestedIframe:!1,placeholder:{enabled:!1,text:"Advertisement",fontSize:"12px",textColor:"#6e7780",backgroundColor:"#f5f8fa"},closeButton:{enabled:!1,showButtonEnabled:!0,preserveState:!1,animation:{enabled:!0,duration:333},labels:{close:"Close ad",show:"Show ad"}},flexible:{enabled:!1,enabledByAds:!1,width:{enabled:!0,min:0,max:9999},height:{enabled:!0,min:0,max:9999},ratio:""},mobileMoments:{enabled:!1},viewability:{percent:50,pixels:0,duration:1e3,clearOnPageInactive:!1},content:{},meta:{shared:{}}}},Pe={client:{closeButton:{animation:{duration:{minimum:0,rule:!0}}},fetch:{minInterval:{minimum:500,rule:!0}},flexible:{width:{min:{minimum:0,maximum:9999,rule:!0},max:{minimum:0,maximum:9999,rule:!0}},height:{min:{minimum:0,maximum:9999,rule:!0},max:{minimum:0,maximum:9999,rule:!0}}},rotation:{period:{minimum:100,rule:!0},limit:{minimum:1,rule:!0}}}};function ye(e,t){Object.keys(t).forEach((i=>{const s=typeof e[i];var n,o;t[i].rule?"undefined"!==s&&(n=e[i],o=t[i],"number"==typeof n&&"number"==typeof o.minimum&&n<o.minimum||"number"==typeof n&&"number"==typeof o.maximum&&n>o.maximum)&&delete e[i]:"object"===s&&ye(e[i],t[i])}))}function Ie(e){const t=j.clone(Re);return j.copy(e,t),t}class Le{static MINIMUM_ROTATION_INTERVAL=100;static DEFAULT_RENDER_TIMEOUT=6e4;service;client;input;constructor(e){this.update(e)}update(e){if(!g.isObject(e.client))throw new Error(`Invalid ${"client"} argument. Object is expected`);if(!g.isSet(e.client.targetElement))throw new Error("No target HTML element configured for position.");const t=((i=j.clone(e)).client&&i.client.features&&(X.warning('JAC: Support for the "features" property of the client config has been deprecated and will be removed in the future versions. Please move all the "features" one level up in the config.'),Object.assign(i.client,i.client.features),delete i.client.features),i);var i;this.input=j.clone(t),ye(t,Pe);const s=Ie(t);Object.assign(this,s)}updateRotationConfig(e){let t=!1;return e?(Object.keys(e).forEach((i=>{const s=e[i];s!==this.client.rotation[i]&&(this.client.rotation[i]=s,t=!0)})),t):t}resetRotationConfig(){const e=Ie(j.clone(this.input)).client.rotation;return this.updateRotationConfig(e)}updateMeta(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"shared",s=!1;const n=g.isString(e)&&g.isSet(t);if(g.isObject(e))this.client.meta=e,s=!0;else if(n){const n=this.client.meta[i];if(n){const i=n[e];n[e]=t,s=t!==i}}return s}getTargetElement(){const e=this.client.targetElement;return g.isString(e)?document.getElementById(e):e}static getFromConfig(e,t){const i=e.service&&e.service.positions||{},s=e.client&&e.client.positions||{},n=i[t],o=s[t];return n||o?{service:n||{},client:o||{}}:null}static updateInConfig(e,t,i){const s=i.service,n=i.client;s&&(e.service=e.service||{},e.service.positions=e.service.positions||{},e.service.positions[t]=s),n&&(e.client=e.client||{},e.client.positions=e.client.positions||{},e.client.positions[t]=n)}static removeFromConfig(e,t){e.service.positions&&delete e.service.positions[t],e.client.positions&&delete e.client.positions[t]}}const Ne="RefreshSmall",xe="RefreshLarge";const Me=class extends e{static FETCH_START="FETCH_START";static FETCH_COMPLETE="FETCH_COMPLETE";static FETCH_TIMEOUT="FETCH_TIMEOUT";static FETCH_ERROR="FETCH_ERROR";static RENDER_START="RENDER_START";static RENDER_COMPLETE="RENDER_COMPLETE";static POSITION_CREATED="POSITION_CREATED";static POSITION_ROTATE="POSITION_ROTATE";static POSITION_RENDER_START="POSITION_RENDER_START";static POSITION_RENDER_COMPLETE="POSITION_RENDER_COMPLETE";static POSITION_RENDER_FAILED="POSITION_RENDER_FAILED";static POSITION_COLLAPSED="POSITION_COLLAPSED";static POSITION_VIEW_START="POSITION_VIEW_START";static POSITION_VIEW_END="POSITION_VIEW_END";static POSITION_VIEWABLE="POSITION_VIEWABLE";static POSITION_CONFIG_CHANGED="POSITION_CONFIG_CHANGED";static AD_LOAD_COMPLETE="AD_LOAD_COMPLETE";static AD_LOAD_TIMEOUT="AD_LOAD_TIMEOUT";static AD_SIZE_CHANGED="AD_SIZE_CHANGED";static AD_MESSAGE="AD_MESSAGE";static AD_CLOSED="AD_CLOSED";static AD_OPENED="AD_OPENED";static NO_AD="NO_AD"},Fe="DEFAULT",Ue={service:{host:"https://jill.fc.yahoo.com/",debug:!1,adServer:{RAS:{params:{}},SSP:{params:{}},PG:{siteAttributes:{}}},positions:{},site:{name:"",queryParams:"",pageSessionId:"xxxxxxxxx".replace(/[x]/g,(function(){return Math.floor(16*Math.random()).toString(16)}))},user:{regs:{gdpr:{apiStatus:de,applies:null,euconsent:""},ccpa:{apiStatus:de,usPrivacy:""}},cookies:{},eids:[]}},client:{focusProtection:!0,positions:{},rotation:{groups:[]},idProviders:{yahoo:{pixelId:"58322",puid:null,email:null}},trackers:{opus:!0,smartPixel:!1,msftSync:!1},metrics:{samplingPercent:5,samplingRateExempt:["FetchTimeoutCount"]}}};function ke(e){const t=j.clone(Ue);var i,s;return j.copy(e,t),i=t,(s=e).service&&s.service.adServer&&Object.keys(ie).forEach((e=>{s.service.adServer[e]||delete i.service.adServer[e]})),function(e,t){t.client&&t.client.idProviders&&t.client.idProviders.yahoo||delete e.client.idProviders.yahoo}(t,e),t}function ze(e,t,i){g.isObject(i)?t[e]={}:Array.isArray(i)&&(t[e]=[])}class Ge{#m;#E={};service;client;input;positions={};static CLIENT_POSITIONS_PROPERTY="client.positions";static SERVICE_PROPERTY="service";static CLIENT_PROPERTY="client";constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;this.#m=i,this.input=function(e){const t=e&&e.service&&e.service.adServer;return t&&g.isObject(t["1AS"])&&(t.RAS=t["1AS"],delete t["1AS"]),t&&g.isObject(t.VZMSSP)&&(t.SSP=t.VZMSSP,delete t.VZMSSP),e}(j.clone(e)),function(e){const t=Ue.service,i=e.document.referrer;i&&(t.site.referrer=i)}(i),function(e){var t,i,s;e&&(e.host&&(Ue.service.host=e.host),null!==(t=e.metrics)&&void 0!==t&&t.samplingPercent&&(Ue.client.metrics.samplingPercent=e.metrics.samplingPercent),null!==(i=e.metrics)&&void 0!==i&&i.samplingRateExempt&&(Ue.client.metrics.samplingRateExempt=e.metrics.samplingRateExempt),null!==(s=e.site)&&void 0!==s&&s.category&&(Ue.service.site.category=e.site.category))}(t),this._initializeConfig()}_initializeConfig(){const e=j.clone(this.input);e.client=e.client||{},e.service=e.service||{};const t=e.service.adServer;t&&t.pointguard&&(t.PG=t.pointguard,delete t.pointguard);const i=ke(e);this.service=i.service,this.client=i.client;const s=Le.getFromConfig(this.input,Fe);s&&(delete this.service.positions.DEFAULT,delete this.client.positions.DEFAULT,this._addOrUpdatePosition(Fe,s)),Object.keys(this.client.positions).forEach((e=>{const t=Le.getFromConfig(this.input,e);this._addOrUpdatePosition(e,t)})),Ge.applyOverrides(this,this.#m.location.href)}addPosition(e,t){this._addOrUpdatePosition(e,t),Ge.applyOverrides(this,this.#m.location.href)}updatePosition(e,t){this._addOrUpdatePosition(e,t),Ge.applyOverrides(this,this.#m.location.href)}_addOrUpdatePosition(e,t){const i=j.clone(t);/^[a-zA-Z0-9_-]+$/.test(e)||X.warning(`Position name ${e} contains invalid characters. Please use only alphanumeric characters.`),e===Fe?this.#E=i:(j.copy(this.#E,i,!0),this.positions[e]?this.positions[e].update(i):this.positions[e]=new Le(i),Le.updateInConfig(this,e,this.positions[e])),Le.updateInConfig(this.input,e,i)}removePosition(e){Le.removeFromConfig(this.input,e),Le.removeFromConfig(this,e),e===Fe?this.#E={}:delete this.positions[e]}setRegulatoryData(e){this.service.user.regs.gdpr.apiStatus=e.data.GDPR.apiStatus,this.service.user.regs.gdpr.applies=e.data.GDPR.applies,this.service.user.regs.gdpr.euconsent=e.data.GDPR.euconsent,this.service.user.regs.ccpa.apiStatus=e.data.CCPA.apiStatus,this.service.user.regs.ccpa.usPrivacy=e.data.CCPA.usPrivacy}setUserIdentity(e){g.isSet(e.ids.CONNECTID)&&this.service.user.eids.push({source:"yahoo.com",uids:[{id:e.ids.CONNECTID}]})}updateConfigSection(e,t){const i=e.split(".");if(i[0]!==Ge.SERVICE_PROPERTY&&i[0]!==Ge.CLIENT_PROPERTY)return X.error("Invalid path provided, it has to start with service or client."),!1;const s=i[0],n=function(e,t,i,s){let n,o=e,r=t;for(let e=1;e<i.length;e++){if(n=i[e],!g.isSet(o[n]))return X.error(`Invalid path, property ${n} does not exist.`),!1;r[n]||ze(n,r,o[n]),e<i.length-1&&(o=o[n],r=r[n])}return o[n]=s,r[n]=s,!0}(this[s],this.input[s],i,t);return n&&this._initializeConfig(),n}getPositionNameFromConfigPath(e){return e.split(".")[2]}clone(){return j.clone({service:this.service,client:this.client})}getFetchTimeout(e){return(e=e||Object.keys(this.positions)).reduce(((e,t)=>{const i=this.positions[t].client.fetch.timeout;return!e||i<e?i:e}),null)}getServiceConfigForFetch(e){const t=j.clone(this.service);if(delete t.user.email,delete t.host,t.debug?t.debug=!0:delete t.debug,!t.site.url){const e=this.#m.location.href;t.site.url=Z.removeParameters(e)}!function(e){e.user.regs.ccpa.usPrivacy||delete e.user.regs.ccpa}(t),j.removeEmptyItems(t),this.service.adServer.PG&&!t.adServer&&(t.adServer={PG:{}});const i={};return e.positionNames.forEach((s=>{const n=t.positions,o=n&&n[s]||(this.service.positions[s]?{}:null);if(o){const t=e.optionsPerPosition[s],n=t?t.fetchSize:null;if(this.positions[s].client.rotation.resizable||!n)i[s]=o;else{const e=`${n.width}x${n.height}`;(t.allowedSizes||o.sizes).includes(e)&&(o.sizes=[e],i[s]=o)}}})),t.positions=i,t}verifyPositionConfig(e){var t;const i=this.positions[e];if(!i)return;if(!0===(null===(t=this.client.positions[e])||void 0===t?void 0:t.render.useConfigSize)){let t=i.service.sizes;g.isString(t)&&pe[t]&&(t=pe[t]),t?t.length>1&&X.warning(`Multiple sizes are set to be used in rendering the ad, the first size is selected for position ${e}.`):X.warning(`No sizes set for ${e}. The ad size will be used.`)}}isServiceConfigValid(){if(!this.service)return X.warning("No service config has been set."),!1;if(!this.service.adServer)return X.warning("No service.adServer config has been set."),!1;if(!this.service.positions)return X.warning("No service.positions config has been set."),!1;const e=this.service.adServer,t=Object.keys(ie).filter((t=>e[t]));if(0===t.length)return X.warning("No valid adServer config has been set."),!1;if(t.length>1)return X.warning("Only one adServer can be configured."),!1;if(t.includes(ie["1AS"])){if(!e["1AS"].region)return X.warning("1AS adServer config requires region to be set."),!1}else if(t.includes(ie.RAS)){if(!e.RAS.region)return X.warning("RAS adServer config requires region to be set."),!1}else if(t.includes(ie.PG)&&(!this.service.site||!this.service.site.spaceId))return X.warning("PG adServer config requires the site spaceId to be set."),!1;return!this.service.host||/^https?:\/\/.*\//i.test(this.service.host)}static applyOverrides(e,t){const i=Z.getParameters(t,["jac.cp","jac.noad","jac.kvs","jac.ip","atwCrPr","atwMN","atwKV"]),s=Object.keys(i).map((e=>`${e}=${i[e]}`)),n=e.service.site.queryParams,o=n?[n]:[];e.service.site.queryParams=o.concat(s).join("&");"1"===Z.getParameter(t,"jac.debug")&&(e.service.debug=!0);const r=Z.getParameter(t,"jac.sf");Object.keys(e.positions).forEach((t=>{const i=e.positions[t];"1"===r&&(i.client.safeFrame.enabled=!0)}));const a=Z.getParameter(t,"jac.rotate");a&&Object.keys(e.positions).forEach((t=>{const i=e.positions[t].client;i.rotation&&("0"===a?i.rotation.enabled=!1:i.rotation.period=1e3*a)}))}}class je extends e{static FETCH_START="Jill.FETCH_START";static FETCH_COMPLETE="Jill.FETCH_COMPLETE";static FETCH_TIMEOUT="Jill.FETCH_TIMEOUT";static FETCH_ERROR="Jill.FETCH_ERROR";static RESPONSE_PROCESSED="Jill.RESPONSE_PROCESSED";constructor(e,t){super(e),this.meta=t}}const Ve={},He={loadScript(e,t,i){const s=document.createElement("script");s.className="jac-fetch",s.src=e,s.onload=t,s.onerror=i;(document.body||document.head).appendChild(s),Ve[e]=s},cleanupScript(e){const t=Ve[e];if(!t)return;t.parentNode.removeChild(t),delete Ve[e]}};class Be{positionNames;completedPositionNames=[];abortedPositionNames=[];startTime;endTime;constructor(e){Object.assign(this,e)}start(){this.startTime||(this.startTime=(new Date).getTime())}end(){this.endTime||(this.endTime=(new Date).getTime(),this.completedPositionNames=this.completedPositionNames.concat(this.positionNames),this.positionNames=[])}isPending(e){return!(this.endTime||e&&!this.positionNames.includes(e))}completePosition(e){this._movePositionName(e,this.completedPositionNames)}abortPosition(e){this._movePositionName(e,this.abortedPositionNames)}isAborted(){return 0===this.positionNames.length&&this.abortedPositionNames.length>0&&0===this.completedPositionNames.length}_movePositionName(e,t){const i=this.positionNames.indexOf(e);i>-1&&!t.includes(e)&&(t.push(e),this.positionNames.splice(i,1))}}class $e extends Be{static ACTION_NAME="fetch";constructor(e){super(e),this.optionsPerPosition=this.optionsPerPosition||{}}isPending(e){return this.status!==re&&super.isPending(e)}}const We={},Ze=new class{toJACPositions(e){var t;const i={...e.ext,positions:{}};return((null===(t=e.seatbid[0])||void 0===t?void 0:t.bid)||[]).forEach((e=>{const t=e.ext.pos;i.positions[t]=i.positions[t]||[],i.positions[t].push(function(e){return{id:e.id,status:e.ext.status,meta:e.ext.meta,content:{markup:e.adm,type:"display",size:{width:e.w,height:e.h,unit:"px"},adId:e.adid,crId:e.crid}}}(e))})),i}};class Je{static REQUEST_ID=1;#f;#_=!0;_fetchActions=We;constructor(e){this.#f=e}process(){if(void 0!==window.JAC_QUEUE&&window.JAC_QUEUE.length>0){let e=window.JAC_QUEUE.shift();const t=e.client?e.client.requestId:0;e.seatbid&&(e=Ze.toJACPositions(e));let i=We[t];if(0===t){e.positions=function(e){if(Array.isArray(e)){const t={};return e.forEach((e=>{t[e.name]=e.data})),t}return e}(e.positions);const t=e.positions;i=new $e({positionNames:Object.keys(t),status:ne}),i.start(),this.trigger(new je(je.FETCH_START,{prefetched:!0,request:{positions:t}}))}if(i.status!==re){this.#_=!1;const s=function(e){return We[e]?We[e].url:void 0}(t);this.trigger(new je(je.RESPONSE_PROCESSED,{response:e,fetchAction:i,url:s}))}return e}return null}fetchAds(e,t){const i=e.positionNames,s=t.getServiceConfigForFetch(e),n=s.requestId=Je.REQUEST_ID++;s.metrics=this.#_;const o=`${t.service.host}v2/ads/js?jacVersion=${this.#f}&config=${encodeURIComponent(JSON.stringify(s))}`;e.url=o,We[n]=e;const r=t.getFetchTimeout(i);let a=!1;function c(e){a||(a=!0,clearTimeout(l),setTimeout((()=>{He.cleanupScript(o)}),0),e())}const l=setTimeout((()=>c((()=>{We[n].status=re,this.trigger(new je(je.FETCH_TIMEOUT,{url:o,positionNames:i}))}))),r);this.trigger(new je(je.FETCH_START,{request:s,url:o})),He.loadScript(o,(()=>c((()=>{this.trigger(new je(je.FETCH_COMPLETE,{url:o}))}))),(e=>c((()=>{this.trigger(new je(je.FETCH_ERROR,{positionNames:i,scriptErrorEvent:e}))}))))}}Object.assign(Je.prototype,f);const Ye=Je;class Xe extends e{static RENDER_START="PositionComponent.RENDER_START";static RENDER_COMPLETE="PositionComponent.RENDER_COMPLETE";static RENDER_FAILED="PositionComponent.RENDER_FAILED";static AD_OPENED="PositionComponent.AD_OPENED";static AD_CLOSED="PositionComponent.AD_CLOSED";static AD_LOAD="PositionComponent.AD_LOAD";static AD_LOAD_TIMEOUT="PositionComponent.AD_LOAD_TIMEOUT";static NO_AD="PositionComponent.NO_AD";static COLLAPSED="PositionComponent.COLLAPSED";static RESIZE="PositionComponent.RESIZE";static DESTROY="PositionComponent.DESTROY";static VIEW_START="PositionComponent.VIEW_START";static VIEW_END="PositionComponent.VIEW_END";static VIEWABLE="PositionComponent.VIEWABLE";static MOUSE_OUT="PositionComponent.MOUSE_OUT";static AD_SIZE_CHANGED="PositionComponent.AD_SIZE_CHANGED";static GEOMETRY_CHANGED="PositionComponent.GEOMETRY_CHANGED";static AD_META_CHANGED="PositionComponent.AD_META_CHANGED";static AD_MESSAGE="PositionComponent.AD_MESSAGE"}class qe extends e{static RENDER_COMPLETE="Render.RENDER_COMPLETE";static AD_LOAD="Render.AD_LOAD";static AD_LOAD_TIMEOUT="Render.AD_LOAD_TIMEOUT";static AD_CLOSED="Render.AD_CLOSED";static AD_OPENED="Render.AD_OPENED";static AD_UNLOADED="Render.AD_UNLOADED";static AD_SIZE_CHANGED="Render.AD_SIZE_CHANGED";static AD_MESSAGE_RECEIVED="Render.AD_MESSAGE_RECEIVED";static AD_GEOMETRY_CHANGE="Render.AD_GEOMETRY_CHANGE"}const Ke={removeChildren(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=e.children;for(let s=i.length-1;s>=0;s--)i[s]!==t&&e.removeChild(i[s])}};class Qe extends e{static READY="SandboxContainer.READY";static UNLOADED="SandboxContainer.UNLOADED";static CLOSED="SandboxContainer.CLOSED";static SIZE_CHANGED="SandboxContainer.SIZE_CHANGED";static GEOMETRY_CHANGE="SandboxContainer.GEOMETRY_CHANGE";static FLEXIBLE_SIZE_REFRESHED="SandboxContainer.FLEXIBLE_SIZE_REFRESHED";static SAFE_FRAME_GEOMETRY_CHANGED="SandboxContainer.SAFE_FRAME_GEOMETRY_CHANGED";static AD_MESSAGE_RECEIVED="SandboxContainer.AD_MESSAGE_RECEIVED"}function et(e,t){const i=e.cookie.split(";").reduce(((e,i)=>{const s=i.indexOf("="),n=i.substring(0,s).trim();return t===n&&(e=i.substring(s+1)),e}),"");return i||null}class tt{#c;#A;#C;#w={};#l=[];#O;constructor(e,t,i){this.#c=e,this.#A=t,this.#C=i,this.#O=i.config.client.safeFrame,this.#w=B.fromSafeFrameConfigToCmdSupportMap(this.#O),this.#l=i.adData.config.service.sizes||[],this._toggleEventListeners(!0)}get messenger(){return this.#c}cleanup(){this._toggleEventListeners(!1),this.#c.cleanup()}_onSizeChange(e){const{width:t,height:i,ratio:s}=e.message.meta,n=this.#C.config.client.flexible;t&&i&&this.#l.includes(`${t}x${i}`)?this.#A.setRenderedSize({width:t,height:i}):s&&(n.enabled||n.enabledByAds)&&(this.#A.enableFlexible(s),this.#A.setRenderedSize({ratio:s}))}_onConfigRequest(e){const t=e.message.meta.flexible,i=this.#C.config.client.flexible;t&&(i.enabled||i.enabledByAds)&&this.#A.updateFlexibleDisplay(t)}_onCloseAd(e){const{closeConfig:t,adSize:i}=e.message.meta;this.#A.closeAd({closeConfig:t,adSize:i})}_onUnload(){this.cleanup(),this.#A.unloadAd()}_onSafeFrameMessage(e){const{cmd:t,meta:i}=e.message;if(!1!==this.#w[t])switch(t){case T.cmd.EXPAND_OVER:case T.cmd.EXPAND_PUSH:this._expand(i,t===T.cmd.EXPAND_PUSH),this._sendStatusUpdate(T.status.EXPANDED,{cmd:t});break;case T.cmd.COLLAPSE:this._collapse(),this._sendStatusUpdate(T.status.COLLAPSED,{cmd:t});break;case T.cmd.READ_COOKIE:this._readCookie(i.cookieName);break;case T.cmd.WRITE_COOKIE:this._writeCookie(i.cookieName,i.cookieData);break;case T.cmd.MSG:this._receivedAdMessage(i);break;case T.cmd.RESIZE_TO:this._resizeTo(i)}else this._sendFailure({cmd:t,reason:"Feature not supported by the host."})}_expand(e){let{top:t,left:i,right:s,bottom:n}=e,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=g.int(t,0,0),i=g.int(i,0,0),s=g.int(s,0,0),n=g.int(n,0,0);const r=this.#A.renderedSize,a={width:r.width+s+i,height:r.height+n+t};o||(a.dx=-i,a.dy=-t),this.#A.updateGeometry(a,o)}_collapse(){this.#A.resetGeometry()}_resizeTo(e){let t,i,{width:s,height:n,ratio:o}=e;this.#A.isFlexible?(t={ratio:o},i={r:o}):(s=g.int(s,0,0),n=g.int(n,0,0),t={width:s,height:n},i={w:s,h:n}),this.#A.setRenderedSize(t),this._sendStatusUpdate(T.status.RESIZE_TO,{cmd:T.cmd.RESIZE_TO,info:i})}_readCookie(e){const t=T.cmd.READ_COOKIE;if(!(this.#O.features.cookies.allowed||[]).includes(e))return void this._sendFailure({cmd:t,reason:Q.FailureReason.INVALID_ARGS,info:{key:e}});let i=et(window.document,e);if(!i){(et(window.document,"SF")||"").split("&").filter((t=>0===t.indexOf(e+"="))).forEach((t=>{const s=et({cookie:t},e);i=i||s}))}this._sendStatusUpdate(T.status.READ_COOKIE,{cmd:t,info:i})}_writeCookie(e,t){const i=T.cmd.WRITE_COOKIE;t.value&&t.value.length>1e3&&(t.value=t.value.substring(0,1e3));if(!(this.#O.features.cookies.allowed||[]).includes(e))return void this._sendFailure({cmd:i,reason:Q.FailureReason.INVALID_ARGS,info:{key:e}});const s=t.value;et(window.document,e)||(t.value=`${e}=${t.value}`,e="SF"),t.expires=t.expires||null,t.expires&&"[object Date]"!==Object.prototype.toString.call(t.expires)&&(t.expires=null),function(e,t,i){if(!i||"string"!=typeof i.value)return;let s=t+"="+i.value;i.expires&&(s+="; expires="+i.expires.toUTCString()),e.cookie=s}(window.document,e,t),this._sendStatusUpdate(T.status.WRITE_COOKIE,{cmd:i,info:s})}_receivedAdMessage(e){this.#A.processAdMessage(e)}_sendStatusUpdate(e,t){let{cmd:i,reason:s,info:n}=t;this.messenger.send(new T({status:e,meta:{cmd:i,reason:s,info:n}}))}_sendFailure(e){let{cmd:t,reason:i,info:s}=e;this._sendStatusUpdate(T.status.FAILED,{cmd:t,reason:i,info:s})}positionMetaChanged(e){this.#O&&this.#O.enabled?this._sendStatusUpdate(T.status.META_UPDATE,{info:e.meta.adMeta}):X.warning("Messages can be sent only to SafeFrame positions.")}_sendSafeFrameGeometryUpdate(e){this.#c.send(new T({status:T.status.GEOMETRY_UPDATE,meta:{info:e.meta}}))}_sendSafeFrameFocusUpdate(e){this.#c.send(new T({status:T.status.FOCUS_CHANGE,meta:{info:e.type===t.FOCUS}}))}_toggleEventListeners(e){const i=e?"on":"off",s=this.#c,n=this.#A,o=this.#C,r=n.pageObserver;s[i](C.topic.SIZE,this._onSizeChange,this),s[i](C.topic.UNLOAD,this._onUnload,this),s[i](C.topic.CLOSE_AD,this._onCloseAd,this),s[i](C.topic.CONFIG,this._onConfigRequest,this),s[i](T.topic.SAFE_FRAME,this._onSafeFrameMessage,this),n[i](Qe.SAFE_FRAME_GEOMETRY_CHANGED,this._sendSafeFrameGeometryUpdate,this),o[i](me.META_UPDATE,this.positionMetaChanged,this),r[i](t.FOCUS,this._sendSafeFrameFocusUpdate,this),r[i](t.BLUR,this._sendSafeFrameFocusUpdate,this)}}function it(e,t){return Math.min(Math.max(e,t.min),t.max)}const st=class{static applyConstraints(e,t){const i=e.width||{},s=e.height||{};t.width.min=it(i.min||0,t.width),t.width.max=it(i.max||Number.MAX_VALUE,t.width),t.height.min=it(s.min||0,t.height),t.height.max=it(s.max||Number.MAX_VALUE,t.height)}static computeFlexibleSize(e,t,i){const{width:s,height:n}=e.flexible,o={};if(!s.enabled&&!n.enabled)return o;let r={width:"100%",height:"100%"};if(W.isSize(e.flexible.ratio)){const s=function(e,t,i,s){const n={};if(t.height.enabled){const o=P.getComputedStyle(i),r=e.height/e.width,a=t.width;let c=a.enabled?parseInt(o.width):s.width;c=it(c,a),n.height=it(c*r,t.height)+"px"}else{const t=e.width/e.height;n.width=s.height*t+"px"}return n}(W.toSize(e.flexible.ratio),e.flexible,t,i);j.copy(s,r)}return s.enabled&&(o.width=r.width,o.minWidth=s.min+"px",o.maxWidth=s.max+"px"),n.enabled&&(o.height=r.height,o.minHeight=n.min+"px",o.maxHeight=n.max+"px"),o}};class nt{offsetTop;offsetLeft;offsetBottom;offsetRight;width;height;constructor(e){let{t=0,l:i=0,r:s=0,b:n=0}=e;this.offsetTop=t,this.offsetLeft=i,this.offsetRight=s,this.offsetBottom=n,this.width=Math.max(this.offsetRight-this.offsetLeft,0),this.height=Math.max(this.offsetBottom-this.offsetTop,0)}normalize(){this.offsetTop=Math.max(this.offsetTop,0),this.offsetLeft=Math.max(this.offsetLeft,0),this.offsetRight=Math.max(this.offsetRight,0),this.offsetBottom=Math.max(this.offsetBottom,0),this.width=Math.max(this.offsetRight-this.offsetLeft,0),this.height=Math.max(this.offsetBottom-this.offsetTop,0)}toSafeFrameClip(){return{t:this.offsetTop,l:this.offsetLeft,r:this.offsetRight,b:this.offsetBottom,w:this.width,h:this.height}}getOffsetDifference(e){const t={top:0,right:0,bottom:0,left:0};return this.offsetTop>e.offsetTop&&this.offsetTop<e.offsetBottom&&(t.top=this.offsetTop-e.offsetTop),this.offsetLeft>e.offsetLeft&&this.offsetLeft<e.offsetRight&&(t.left=this.offsetLeft-e.offsetLeft),this.offsetRight<e.offsetRight&&this.offsetRight>e.offsetLeft&&(t.right=e.offsetRight-this.offsetRight),this.offsetBottom<e.offsetBottom&&this.offsetBottom>e.offsetTop&&(t.bottom=e.offsetBottom-this.offsetBottom),t}addHorizontalClipping(e,t){e>this.offsetLeft&&(this.offsetLeft=e),t<this.offsetRight&&(this.offsetRight=t)}addVerticalClipping(e,t){e>this.offsetTop&&(this.offsetTop=e),t<this.offsetBottom&&(this.offsetBottom=t)}}function ot(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;const i=U.getElementGeometry(e,t),s=U.getPageScrollInfo(),n={t:i.top,l:i.left,r:i.right,b:i.bottom,w:i.width,h:i.height,z:i.zIndex};return(s.y||s.x)&&(n.l+=s.x,n.t+=s.y),n.b=n.t+i.height,n.r=n.l+i.width,Object.keys(n).forEach((e=>{"number"==typeof n[e]&&(n[e]=Math.round(n[e]))})),n}function rt(){const e=U.getPageScrollInfo(),t=U.getWindowGeometry();return{t:e.y,l:e.x,r:e.x+t.width,b:e.y+t.height,w:t.width,h:t.height}}function at(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window;const n=20,o=U.getPageScrollInfo();let r,a,c,l=P.getComputedStyle(e,null,s);for(;l;){const d=e===i;if("block"===l.display||"absolute"===l.position||"none"!==l.float){const i=ot(e,s);let h=i.t,u=i.l,g=i.r,p=i.b,m=e.offsetWidth,E=e.offsetHeight,f=e.clientWidth,_=e.clientHeight;if(!r&&m>f){const e=m-f;r=e<=n?e:0}if(!a&&E>_){const e=E-_;a=e<=n?e:0}d?(e.scrollWidth>f&&(u=0,g=(window.innerWidth||m)+o.x,window.innerWidth&&window.innerWidth>f&&(g-=window.innerWidth-f),t.addHorizontalClipping(u,g)),e.scrollHeight>_&&(h=0,p=(window.innerHeight||E)+o.y,window.innerHeight&&window.innerHeight>_&&(p-=window.innerHeight-_),t.addVerticalClipping(h,p))):(r&&g-u===m&&(g-=r),a&&p-h===E&&(p-=a),U.isClippingElement(e,"X",l)&&t.addHorizontalClipping(u,g),U.isClippingElement(e,"Y",l)&&t.addVerticalClipping(h,p),!c&&U.isScrollableElement(e,l)&&(c=e))}if(d)break;if((e=e.parentNode)&&Node.DOCUMENT_FRAGMENT_NODE===e.nodeType&&(e=e.parentNode),!e)break;l=P.getComputedStyle(e,null,s)}return{scrollParent:c,xScrollBarHeight:a,yScrollBarWidth:r}}class ct{static GEOMETRY_UPDATE="GEOMETRY_UPDATE";#v;#S;#m;#T;constructor(e,i){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;this.#v=e,this.#S=i,this.#m=s,this.#T=n((()=>this.dispatchGeometryChange()),1e3),this.#v.on(t.SCROLL,this.#T),this.#v.on(t.RESIZE,this.#T)}buildGeometry(){return{win:this.buildWindowGeometry(),self:this.buildSelfGeometry(),exp:this.buildExpandableGeometry(),par:this.buildParentGeometry()}}winHasFocus(){return this.#v.hasFocus}dispatchGeometryChange(){this.trigger(new e(ct.GEOMETRY_UPDATE,this.buildGeometry()))}destroy(){this.#v.off(t.SCROLL,this.#T),this.#v.off(t.RESIZE,this.#T)}buildWindowGeometry(){const e=U.getWindowGeometry();return{t:e.top,l:e.left,r:e.right,b:e.bottom,w:e.width,h:e.height}}buildSelfGeometry(){const e=this.#m,t=ot(this.#S,e),i=U.getVisibilityMetrics(this.#S,e);return t.xiv=parseFloat(i.xPercentage.toFixed(2)),t.yiv=parseFloat(i.yPercentage.toFixed(2)),t.iv=parseFloat(i.totalPercentage.toFixed(2)),t}buildExpandableGeometry(){const e=this.#m,t=ot(this.#S,e),i=U.getDocumentElement(),s=rt(),n=new nt(s),o=at(this.#S,n,i,e);n.normalize();const r=new nt(t).getOffsetDifference(n),a={t:r.top,l:r.left,r:r.right,b:r.bottom};return o.scrollParent?(a.xs=!!o.xScrollBarHeight,a.ys=!!o.yScrollBarWidth):(a.xs=i.scrollWidth>i.clientWidth,a.ys=i.scrollHeight>i.clientHeight),a}buildParentGeometry(){const e=this.#m,t=U.getDocumentElement(),i=rt(),s=new nt(i),n=at(this.#S,s,t,e);if(n.scrollParent){const s=ot(n.scrollParent,e),o=new nt(s);return at(n.scrollParent,o,t,e),o.addHorizontalClipping(i.l,i.r),o.addVerticalClipping(i.t,i.b),o.normalize(),o.toSafeFrameClip()}return s.normalize(),s.toSafeFrameClip()}set element(e){this.#S=e}}Object.assign(ct.prototype,f);const lt=ct;class dt{#b;#D;#R=!1;#P;#y;position;clientConfig;flexibleConfig;pageObserver;windowContext;positionElement;element;iframe;sandboxBridge;safeFrameGeometry;isExpanded=!1;adDataSize;constructor(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:window;this.position=e,this.clientConfig=e.config.client,this.flexibleConfig=j.clone(this.clientConfig.flexible),this.iframe=t,this.pageObserver=i,this.windowContext=s,this._toggleEventListeners(!0)}render(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.positionElement=e,this.element=document.createElement("div"),this.element.className="jac-sandbox-container",this.adDataSize=t.content.size,this.#y=t.status;const s=this.clientConfig.placeholder;if(s.enabled){const e=O.createPlaceholderSvg(s);P.setStyles(this.element,{backgroundImage:`url(data:image/svg+xml;base64,${btoa(e)})`})}this.position.containerType===ae.SAFE_FRAME&&this._addSafeFrameGeometry(),this._toggleVisibility(i),this.setRenderedSize(this.adDataSize)}injectIframe(){const e=this.flexibleConfig;this.element.appendChild(this.iframe),e.enabled?this.setRenderedSize({ratio:e.ratio}):this._resetFlexibleSize(),this.clientConfig.render.delayedLoadInLegacyIE&&g.isOldIE(this.windowContext)?this._addDelayedLoadListener():this.#R=!0}setSandboxBridge(e){this.sandboxBridge=e,this._triggerEventIfReady()}_triggerEventIfReady(){this.sandboxBridge&&this.#R&&this._triggerEvent(Qe.READY)}_resize(e){let{width:t,height:i,top:s=0,left:n=0,resizeContainer:o}=e;o&&(P.setStyles(this.element,{position:"relative",width:`${t}px`,height:`${i}px`}),this._triggerEvent(Qe.SIZE_CHANGED,{width:t,height:i})),P.setStyles(this.iframe,{width:`${t}px`,height:`${i}px`,top:`${s}px`,left:`${n}px`})}updateGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isExpanded=!0,this._resize({width:e.width,height:e.height,top:e.dy||0,left:e.dx||0,resizeContainer:t});const i=this.getGeometry();this._triggerEvent(Qe.GEOMETRY_CHANGE,i)}resetGeometry(){if(this.isExpanded=!1,this.#P){this._resize({width:this.#P.width,height:this.#P.height,top:0,left:0,resizeContainer:!0});const e=this.getGeometry();this._triggerEvent(Qe.GEOMETRY_CHANGE,e)}}getGeometry(){return U.getElementGeometry(this.element)}get renderedSize(){return this.#P||{}}setRenderedSize(e){if(this.position.hasMobileMomentsAd)return;if(e.width&&e.height){(!this.#P||this.#P.width!==e.width||this.#P.height!==e.height)&&(this.#P=e,this._resize({width:e.width,height:e.height,resizeContainer:!0}))}else this.isFlexible&&(this.flexibleConfig.ratio=e.ratio,this._refreshFlexibleSize(this.adDataSize,this.flexibleConfig))}_refreshFlexibleSize(e,t){const i=st.computeFlexibleSize({flexible:{...t}},this.positionElement.parentNode,e);P.setStyles(this.element,i),P.setStyles(this.iframe,i),this._triggerEvent(Qe.FLEXIBLE_SIZE_REFRESHED,{styles:i});const s=this.getGeometry(),n={width:s.width,height:s.height};n.width&&n.height&&this.setRenderedSize(n)}_resetFlexibleSize(){this._triggerEvent(Qe.FLEXIBLE_SIZE_REFRESHED,{styles:{minWidth:null,maxWidth:null,minHeight:null,maxHeight:null}})}enableFlexible(e){this.flexibleConfig.enabled=!0,this.flexibleConfig.ratio=e}updateFlexibleDisplay(e){st.applyConstraints(e,this.flexibleConfig),this.isFlexible&&this._refreshFlexibleSize(this.adDataSize,this.flexibleConfig)}get isFlexible(){return this.flexibleConfig.enabled}show(){this._toggleVisibility(!0)}hide(){this._toggleVisibility(!1)}processAdMessage(e){this._triggerEvent(Qe.AD_MESSAGE_RECEIVED,{message:e})}_addDelayedLoadListener(){const e=this.iframe;this.#D=()=>{e.removeEventListener("load",this.#D,!1),this.#R=!0,this._triggerEventIfReady()},e.addEventListener("load",this.#D,!1)}removeLoadListeners(){this.#D&&this.iframe.removeEventListener("load",this.#D,!1)}closeAd(e){let{closeConfig:t,adSize:i}=e;this._triggerEvent(Qe.CLOSED,{closeConfig:t,adSize:i})}unloadAd(){this.setRenderedSize({width:1,height:1,unit:"px"}),this._triggerEvent(Qe.UNLOADED)}clear(){this.cleanup(),Ke.removeChildren(this.element)}cleanup(){this.sandboxBridge.cleanup(),this.removeLoadListeners(),this._toggleEventListeners(!1),this.safeFrameGeometry&&this._removeSafeFrameGeometry()}get adStatus(){return this.#y}_toggleVisibility(e){P.setStyles(this.element,{display:e?"block":"none"})}_addSafeFrameGeometry(){const e=this.safeFrameGeometry=new lt(this.pageObserver,this.element,this.windowContext);this.#b=e=>{this._triggerEvent(Qe.SAFE_FRAME_GEOMETRY_CHANGED,e.meta)},e.on(lt.GEOMETRY_UPDATE,this.#b,this)}_removeSafeFrameGeometry(){this.safeFrameGeometry.destroy(),this.safeFrameGeometry.off(lt.GEOMETRY_UPDATE,this.#b,this)}_pageResizeListener(){this.isFlexible&&this.setRenderedSize({ratio:this.flexibleConfig.ratio})}_toggleEventListeners(e){const i=e?"on":"off";this.pageObserver[i](t.RESIZE,this._pageResizeListener,this)}_triggerEvent(e,t){this.trigger(new Qe(e,t))}}Object.assign(dt.prototype,f);const ht=dt,ut="string"!==d?"1.5.0":"0.0.0",gt="https://jac.yahoosandbox.com";function pt(){return Math.floor(1e7*Math.random()).toString()}function mt(e,t,i){const s=t.sandbox;let n=window.JAC_SANDBOX_BASE_URL||s.baseUrl||e.clientBaseUrl||gt;return s.uniqueDomain&&(n=n.replace("https://",`https://j${pt()}.`)),`${n}/${ut}/${i}`}function Et(e,t){const i={id:"jacSandbox_"+pt(),title:"Advertisement",itemtype:"https://schema.org/WPAdBlock",itemscope:"",tabindex:"-1",allowtransparency:"true",scrolling:"no"},s=t.sandbox;s&&(i.sandbox=s.allow.map((e=>`allow-${e}`)).join(" "),i.allow=function(e){let t=[];return Object.keys(e).forEach((i=>{const s=e[i];if(!s.enabled)return;const n=[];n.push(i),s.allow&&s.allow.forEach((e=>{0===(e=e.trim()).indexOf("https:")?n.push(e):0===e.indexOf("http:")?n.push(e.replace("http:","https:")):n.push("https://"+e)})),t.push(n.join(" "))})),t.join(";")}(s.features),s.features.fullscreen.enabled&&(i.allowfullscreen=!0));const n=document.createElement("iframe");Object.keys(i).forEach((e=>{n.setAttribute(e,i[e])}));const{width:o,height:r}=e;return P.setStyles(n,{position:"absolute",top:"0",left:"0",width:`${o}px`,height:`${r}px`,border:"0",overflow:"hidden",zIndex:t.layout.zIndex}),n}function ft(e,t,i){const s=t.containerType;if(s===ae.FRIENDLY_IFRAME)!function(e,t){const i=e.contentWindow.document;i.open(),i.write('<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>html,body{margin:0;padding:0;width:100%;height:100%}</style></head><body><script src="'+t+'"><\/script><script>var inFIF=true,inDapIF=true;<\/script></body></html>'),i.close()}(e,function(e){return`${window.JAC_BASE_URL||e.clientBaseUrl||gt}/${ut}/jac.js`}(i));else{const n=t.config.client;s===ae.SAFE_FRAME?e.src=mt(i,n,"safeframe.html"):s===ae.NON_FRIENDLY_IFRAME&&(e.src=mt(i,n,"sandbox.html"))}}class _t{#I;#L;#N;#x;#M=!0;#F=[];component;pageObserver;adData;renderingContainer=null;renderedContainer=null;static create(e,t){return new _t(e,t)}constructor(e,t){this.component=e,this.pageObserver=t}preparePositionElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=this.component.position,i=t.config.getTargetElement(),s=document.createElement("div");return s.id=`jacPosition_${t.name}`,s.className="jac-container",e?P.setStyles(s,{display:e.style.display,position:e.style.position,width:e.style.width,height:e.style.height}):P.setStyles(s,{display:"block",position:"relative"}),i.innerHTML="",i.appendChild(s),s}render(e){var t;this.adData=e;const i=this.component,s=i.element,n=i.position,o=n.config.client,r=o.render,a=this.pageObserver,c=null===(t=this.adData.config.service)||void 0===t?void 0:t.sizes;if(r.useConfigSize&&c&&c.length>0){const e=c[0].split("x");this.adData.content.size.width=parseInt(e[0]),this.adData.content.size.height=parseInt(e[1])}this.renderingContainer&&this._cleanupRenderingSandbox(),this.#I=setTimeout((()=>{this._onAdLoadTimeOut()}),r.timeout),!r.doubleBuffering&&this.renderedContainer&&(this._resetClosedAd(e.content.size.height),this._cleanupRenderedSandbox());const l=Et(e.content.size,o),d=new ht(n,l,a);this._toggleSandboxEventListeners(d),this.renderingContainer=d;const h=!r.doubleBuffering||this.#M;d.render(s,e,h),s.appendChild(d.element);const u=function(e,t,i,s){const n={adData:e,token:pt()};return t.containerType===ae.SAFE_FRAME&&(n.safeFrame={geom:i.safeFrameGeometry.buildGeometry(),focus:s.hasFocus,meta:t.config.client.meta}),n}(e,n,d,a);l.setAttribute("name",JSON.stringify(u)),d.injectIframe();const g=function(e,t,i,s,n){const o=new R(e.contentWindow,t.token);return o.listen(),o.on(C.topic.WRITE_COMPLETE,(()=>{e.removeAttribute("name"),n._triggerEvent(qe.RENDER_COMPLETE)})),o.on(C.topic.PAGE_LOAD,(()=>{n._onAdLoaded()})),new tt(o,i,s)}(l,u,d,n,this);d.setSandboxBridge(g),this.#M=!1}clear(){var e,t;clearTimeout(this.#I),this.#I=null,this.#F=[],null===(e=this.renderedContainer)||void 0===e||e.clear(),null===(t=this.renderingContainer)||void 0===t||t.clear(),this.renderedContainer=null,this.renderingContainer=null}reset(){this._cleanupRenderingSandbox(),this._cleanupRenderedSandbox(),this.component.element.parentNode.removeChild(this.component.element),this.#x&&this.#N&&this.#N.removeEventListener("click",this.#x)}get adClosed(){return this.#L}get showButton(){return this.#N}_onAdClose(e){if(this.#L)return;this.#L=!0;const{closeConfig:t,adSize:i}=e.meta,s=t.showButtonEnabled?26:0;this._toggleCloseShowAd(t,s,(()=>{this._showClosedAd(t,s,i)}))}_showClosedAd(e,t,i){var s,n;const o=this.component.element;if(null===(s=this.renderedContainer)||void 0===s||s.hide(),null===(n=this.renderingContainer)||void 0===n||n.hide(),P.setStyles(o,{height:`${t}px`}),this._triggerEvent(qe.AD_CLOSED),!e.showButtonEnabled)return;const r=O.createOpenAdButton(e.labels.show,i.width);this.#N=r,this.#x||(this.#x=()=>this.showAd(e)),r.addEventListener("click",this.#x,!1),o.appendChild(r)}showAd(e){var t,i;const s=this.component;this._cleanupCloseAdButton(),null===(t=this.renderedContainer)||void 0===t||t.show(),null===(i=this.renderingContainer)||void 0===i||i.show();const n=s.size.height;this._toggleCloseShowAd(e,n,(()=>{this.#L=!1,P.setStyles(s.element,{overflow:null,transition:null,height:null}),this._triggerEvent(qe.AD_OPENED)}))}_cleanupCloseAdButton(){this.#N&&(this.#N.removeEventListener("click",this.#x),this.#N.parentNode.removeChild(this.#N),this.#N=null,this.#x=null)}_resetClosedAd(e){this.#L&&(this._cleanupCloseAdButton(),this.#L=!1,P.setStyles(this.component.element,{height:`${e}px`,overflow:null,transition:null}))}_toggleCloseShowAd(e,t,i){const s=this.component.element;e.animation&&!0===e.animation.enabled?(P.setStyles(s,{overflow:"hidden",height:`${t}px`,transition:`height ${e.animation.duration}ms linear`}),setTimeout((()=>{i()}),e.animation.duration)):(P.setStyles(s,{height:`${t}px`}),i())}_cleanupSandboxContainer(e,t){null==e||e.cleanup(),Ke.removeChildren(this.component.element,null==t?void 0:t.element)}_cleanupRenderedSandbox(){this._cleanupSandboxContainer(this.renderedContainer,this.renderingContainer),this.renderedContainer=null}_cleanupRenderingSandbox(){clearTimeout(this.#I),this.#I=null,this.#F=[],this._cleanupSandboxContainer(this.renderingContainer,this.renderedContainer),this.renderingContainer=null}_onAdLoaded(){if(clearTimeout(this.#I),this.#I=null,this.renderingContainer.removeLoadListeners(),this.renderingContainer.adStatus===oe&&this.component.position.config.client.render.doubleBuffering&&this.renderedContainer)return this._cleanupRenderingSandbox(),void this._triggerEvent(qe.AD_LOAD);this._resetClosedAd(this.component.size.height),this._cleanupRenderedSandbox(),this._flushActionsBuffer(),this.renderedContainer=this.renderingContainer,this.renderingContainer=null,this.renderedContainer.show(),this._triggerEvent(qe.AD_LOAD)}_onAdLoadTimeOut(){this._cleanupRenderingSandbox(),this._triggerEvent(qe.AD_LOAD_TIMEOUT)}_onContainerReady(e){const t=e.target;ft(t.iframe,t.position,this.adData)}_onSizeChanged(e){this._performBufferableAction(e,(()=>{P.setStyles(this.component.element,{width:`${e.meta.width}px`,height:`${e.meta.height}px`}),this._triggerEvent(qe.AD_SIZE_CHANGED,e.meta)}))}_onFlexibleSizeRefreshed(e){this._performBufferableAction(e,(()=>{const t=e.meta.styles;P.setStyles(this.component.element,t)}))}_onUnload(e){e.target===this.renderingContainer?this._cleanupRenderingSandbox():this._cleanupRenderedSandbox(),this._triggerEvent(qe.AD_UNLOADED)}_onAdMessageReceived(e){this._performBufferableAction(e,(()=>{this._triggerEvent(qe.AD_MESSAGE_RECEIVED,e.meta)}))}_onAdGeometryChanged(e){this._performBufferableAction(e,(()=>{this._triggerEvent(qe.AD_GEOMETRY_CHANGE,e.meta)}))}_performBufferableAction(e,t){e.target===this.renderingContainer&&this.component.position.config.client.render.doubleBuffering?this.#F.push(t):t()}_flushActionsBuffer(){this.#F.forEach((e=>e())),this.#F=[]}_triggerEvent(e,t){this.trigger(new qe(e,t))}_toggleSandboxEventListeners(e){const t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?"on":"off",{READY:i,UNLOADED:s,CLOSED:n,SIZE_CHANGED:o,AD_MESSAGE_RECEIVED:r,FLEXIBLE_SIZE_REFRESHED:a,GEOMETRY_CHANGE:c}=Qe;e[t](i,this._onContainerReady,this),e[t](s,this._onUnload,this),e[t](n,this._onAdClose,this),e[t](o,this._onSizeChanged,this),e[t](a,this._onFlexibleSizeRefreshed,this),e[t](r,this._onAdMessageReceived,this),e[t](c,this._onAdGeometryChanged,this)}}Object.assign(_t.prototype,f);const At=_t;class Ct{time;limit;remaining;callback;#U;constructor(e){let{time:t,limit:i,callback:s}=e;this.time=t,this.remaining=this.limit=i,this.callback=s}start(){(!g.isSet(this.remaining)||this.remaining>0)&&(this.#U=setTimeout((()=>{g.isSet(this.remaining)&&this.remaining--,this.callback()}),this.time))}stop(){clearTimeout(this.#U)}restart(){this.stop(),this.start()}reset(){this.stop(),this.remaining=this.limit}}class wt{#k;#z;#G;#j;#V=!1;#H=!1;#B=!1;#$=!1;#W;#P;#Z;#m;pageObserver;position;element;renderer;constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;this.position=e,this.pageObserver=t,this.#m=i,this.renderer=At.create(this,t),this.element=this.renderer.preparePositionElement(),this._toggleRendererEventListeners(!0),this.#G=()=>this._onMouseOver(),this.#j=()=>this._onMouseOut(),this._toggleElementListeners(!0)}render(){this._refreshTargetContainerIfChanged(),this.#H=!0,this.#B=!1;const e=this.#k=this.position.adData;this.position.updateContainerType(e.meta),this.#z||this._togglePageObserverEventListeners(!0),this._pageStateChanged(),this.position.config.client.render.requireViewable||this._processAndInjectAd()}_processAndInjectAd(){const e=this.#k,t=this.position.config.client.render;if(this.#H=!1,this._triggerEvent(Xe.RENDER_START),e.status!==oe&&e.status!==ne||t.abortOnFocus&&this.isFocused||t.abortOnMouseOver&&this.hasMouseOver||t.abortOnExpandedAd&&this.isExpanded)this._triggerEvent(Xe.RENDER_FAILED);else{if(e.status===oe){e.content.size={width:1,height:1,unit:"px"},this._triggerEvent(Xe.NO_AD);let i=!1;if(e.exclusionStatus){const t=e.exclusionStatus;g.isString(t.replaced)&&t.replaced.includes(this.position.name)&&(this.renderer.clear(),i=!0)}t.doubleBuffering&&!i||this._triggerEvent(Xe.COLLAPSED)}this.renderer.render(e)}}_refreshTargetContainerIfChanged(){if(this.position.config.getTargetElement()!==this.element.parentNode){const e=this.element;this._toggleElementListeners(!1),this.renderer.reset(),this.element=this.renderer.preparePositionElement(e),this._toggleElementListeners(!0)}}destroy(){this._togglePageObserverEventListeners(!1),this._toggleElementListeners(!1),this._toggleRendererEventListeners(!1),this.renderer.reset(),this._triggerEvent(Xe.DESTROY)}abortRender(){this.clearAd(),this.#P=null,this.#V=!1}clearAd(){this.renderer.clear()}_isAreaInView(){const e=this.position.config.client.viewability,t=e.percent/100,i=U.getVisibilityMetrics(this.element,this.#m),s=i.totalPercentage>=t;let n=0;return e.pixels>0&&(n=i.totalPercentage*i.containerPixels),s||e.pixels>0&&n>=e.pixels}get isInView(){return this.#$}get isExpanded(){var e;return!(null===(e=this.renderer.renderedContainer)||void 0===e||!e.isExpanded)}get hasMouseOver(){return this.#V}get adClosed(){return this.renderer.adClosed}get isFocused(){var e;const t=null===(e=this.renderer.renderedContainer)||void 0===e?void 0:e.iframe;return t&&document.activeElement===t}get size(){return this.#P||{}}get lastAdSize(){return this.#Z}_pageStateChanged(){const e=this.position.config.client,t=this.pageObserver,i=t.isVisible&&t.hasFocus,s=t.isVisible&&this._isAreaInView();this._changeViewabilityState(s),e.render.requireViewable&&this.#H&&s?this._processAndInjectAd():e.viewability.clearOnPageInactive&&!i&&this.clearAd()}_changeViewabilityState(e){e!==this.#$&&(this.#$=e,this._fireVisibilityEvent(e),this.#W&&(e&&this.#B?this.#W.restart():this.#W.stop()))}_fireVisibilityEvent(e){const t=e?Xe.VIEW_START:Xe.VIEW_END;this._triggerEvent(t)}_onRenderComplete(){this.#B=!0,this._triggerEvent(Xe.RENDER_COMPLETE,this.renderer.renderingContainer.renderedSize),this.#W?this.#W.reset():this.#W=new Ct({time:this.position.config.client.viewability.duration,limit:1,callback:()=>this._triggerEvent(Xe.VIEWABLE)}),this.#$&&this.#W.restart()}_onAdClosed(){this._triggerEvent(Xe.AD_CLOSED)}_onAdOpened(){this._triggerEvent(Xe.AD_OPENED)}_onAdLoad(){this._triggerEvent(Xe.AD_LOAD)}_onAdLoadTimeOut(){this._triggerEvent(Xe.AD_LOAD_TIMEOUT)}_onAdUnloaded(){this._triggerEvent(Xe.NO_AD),this.position.config.client.render.doubleBuffering||(this.abortRender(),this._triggerEvent(Xe.COLLAPSED))}_onAdSizeChanged(e){const t=e.meta,i=this.position;this.#P=t,t.width>1&&t.height>1&&i.adData.config.service.sizes&&i.config.service.sizes.includes(`${t.width}x${t.height}`)&&(this.#Z=t),this._triggerEvent(Xe.AD_SIZE_CHANGED,e.meta)}_onMouseOver(){this.#V=!0}_onMouseOut(){this.#V=!1,this._triggerEvent(Xe.MOUSE_OUT)}_onAdMessageReceived(e){this._triggerEvent(Xe.AD_MESSAGE,e.meta)}_onAdGeometryChanged(e){this._triggerEvent(Xe.RESIZE,e.meta)}_triggerEvent(e,t){this.trigger(new Xe(e,Object.assign({positionName:this.position.name},t)))}_toggleElementListeners(){const e=(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?"add":"remove")+"EventListener";this.element[e]("mouseover",this.#G),this.element[e]("mouseout",this.#j)}_toggleRendererEventListeners(){const e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?"on":"off",t=this.renderer,{RENDER_COMPLETE:i,AD_LOAD:s,AD_LOAD_TIMEOUT:n,AD_OPENED:o,AD_CLOSED:r,AD_UNLOADED:a,AD_SIZE_CHANGED:c,AD_MESSAGE_RECEIVED:l,AD_GEOMETRY_CHANGE:d}=qe;t[e](i,this._onRenderComplete,this),t[e](s,this._onAdLoad,this),t[e](n,this._onAdLoadTimeOut,this),t[e](o,this._onAdOpened,this),t[e](r,this._onAdClosed,this),t[e](a,this._onAdUnloaded,this),t[e](c,this._onAdSizeChanged,this),t[e](l,this._onAdMessageReceived,this),t[e](d,this._onAdGeometryChanged,this)}_togglePageObserverEventListeners(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const i=e?"on":"off",{SCROLL:s,RESIZE:n,VISIBILITY:o,FOCUS:r,BLUR:a}=t;[s,n,o,r,a].forEach((e=>{this.pageObserver[i](e,this._pageStateChanged,this)})),this.#z=e}}Object.assign(wt.prototype,f);const Ot=wt;function vt(e){return e&&"IFRAME"===e.tagName&&e.id&&0===e.id.indexOf("jacSandbox_")}class St{static FOCUS_PLACE_HOLDER;focusedElement;iframeMouseOver=!1;#m;#v;init(e,i){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;!this.#v&&i._config.client.focusProtection&&(this.#v=e,this.#m=s,this.focusedElement=s.document.activeElement,e.on(t.BLUR_CAPTURE,this._onPageBlurCapture,this),e.on(t.FOCUS_IN,this._onPageFocusIn,this),e.on(t.MOUSE_OVER,this._onMouseOver,this),e.on(t.MOUSE_OUT,this._onMouseOut,this))}get pageObserver(){return this.#v}_onPageBlurCapture(e){setTimeout((()=>{const t=this.#m.document,i=vt(t.activeElement);i||e.target===this.#m||this.focusedElement===t.activeElement||(this.focusedElement=null),i&&!this.iframeMouseOver&&(this.focusedElement&&this.focusedElement!==this.#m&&this.focusedElement!==t.body?this.focusedElement.focus():(this._createFocusPlaceHolder(),St.FOCUS_PLACE_HOLDER.focus(),this.#m.focus()))}),0)}_createFocusPlaceHolder(){if(!St.FOCUS_PLACE_HOLDER){const e=this.#m.document,t=St.FOCUS_PLACE_HOLDER=e.createElement("span");t.tabIndex=-1,e.body.insertBefore(t,e.body.firstChild)}}_onPageFocusIn(e){"IFRAME"!==e.meta.nativeEvent.target.tagName&&(this.focusedElement=e.meta.nativeEvent.target)}_onMouseOver(e){vt(e.meta.nativeEvent.target)&&(this.iframeMouseOver=!0)}_onMouseOut(e){vt(e.meta.nativeEvent.target)&&(this.iframeMouseOver=!1)}}class Tt extends e{static ROTATION="Scheduler.ROTATION";static ROTATION_PREVENTED="Scheduler.ROTATION_PREVENTED";static ROTATION_PREVENTED_REASONS={RenderNotComplete:"RenderNotComplete",MouseOver:"MouseOver",PageHidden:"PageHidden",PageNotFocused:"PageNotFocused",Expanded:"Expanded",NotInView:"NotInView",BelowInViewDuration:"BelowInViewDuration"}}function bt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"log";for(var t=arguments.length,i=new Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];X[e]("JAC Rotation Scheduler:",...i)}function Dt(e){bt("warning",e)}function Rt(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];bt("debug",...t)}class Pt{#v;schedulerRegistry={};rotationConfig={};positionComponents={};intervals={};constructor(e){this.#v=e}init(){this.#v.on(t.VISIBILITY,(e=>this._onPageVisibilityChange(e)),this),this.#v.on(t.FOCUS,(e=>this._onPageVisibilityChange(e)),this)}applyGlobalRotationConfig(e){this.rotationConfig=e}register(e){const t=e.config.client.rotation,i=e.name;if(this.isPositionRegistered(i))return void Dt(`Registering position ${i}, but it is already registered.`);if(!t.enabled)return void Dt(`Position ${i} has rotation disabled.`);let s=!1,n=null;e.render&&e.render.completedPositionNames.includes(i)&&(s=!0,n=e.render.endTime),this.schedulerRegistry[i]={name:i,rotationCount:0,renderDone:s,viewStartTimestamp:n,rotationConfig:j.clone(t)},this.startScheduling(i),e.on(me.ROTATION_UPDATE,this._onPositionRotationConfigUpdate,this)}deregister(e){const t=e.name,i=this.schedulerRegistry[t];if(!i)return void Dt(`De-registering position ${t}, but it has not been registered.`);i.rotationConfig.cancellable?(this.stopScheduling(t),e.off(me.ROTATION_UPDATE,this._onPositionRotationConfigUpdate,this),delete this.schedulerRegistry[t]):Dt(`Position ${t} is not cancellable.`)}resetRegistration(e){const t=e.name;this.schedulerRegistry[t].rotationCount=0,e.resetRotation(),this.startScheduling(t)}isPositionRegistered(e){return!!this.schedulerRegistry[e]}subscribe(e){const t=e.position.name;this.isPositionRegistered(t)?this.positionComponents[t]?Dt(`Subscribing to an already subscribed PositionComponent for position ${t}.`):(this.positionComponents[t]=e,this._togglePositionObservers(e,!0)):Dt(`Subscribing to PositionComponent for a non-registered position ${t}.`)}unsubscribe(e){const t=e.position.name;this.isPositionRegistered(t)?this.positionComponents[t]?(this._togglePositionObservers(e,!1),delete this.positionComponents[t]):Dt(`Unsubscribing from a non-subscribed PositionComponent for position ${t}.`):Dt(`Unsubscribing from PositionComponent for a non-registered position ${t}.`)}startScheduling(e){const t=this.schedulerRegistry[e];if(t.rotationCount>=t.rotationConfig.limit)return void Dt(`Scheduling position ${e}, which has exceeded the rotation limit.`);const i=t.rotationConfig.period;this._scheduleInterval(i);const s=this.intervals[i];s.positionNames.includes(e)||s.positionNames.push(e)}stopScheduling(e){const t=this.schedulerRegistry[e].rotationConfig.period,i=this.intervals[t];i?(G.remove(i.positionNames,e),i.positionNames.length<=0&&(clearTimeout(i.timeout),delete this.intervals[t])):Dt(`Removing position ${e} from schedule, but it is not scheduled.`)}_onPositionRotationConfigUpdate(e){const t=e.target,i=t.name,s=this.schedulerRegistry[i],n=t.config.client.rotation,o=s.rotationConfig.period!==n.period;if(o&&this.stopScheduling(i),s.rotationConfig=j.clone(n),n.enabled)o&&this.startScheduling(i);else{const e=this.positionComponents[i];e&&this.unsubscribe(e),this.deregister(t)}}_scheduleInterval(e){const t=this.intervals[e]=this.intervals[e]||{positionNames:[],timeout:null};t.timeout||(Rt("Scheduling rotation interval in",e),t.timeout=setTimeout((()=>{t.timeout=null,this._intervalElapsed(e)}),e))}_intervalElapsed(e){Rt("Interval elapsed",e);const t=(new Date).getTime(),i=this.intervals[e],s=i.positionNames.filter((e=>this._isPositionEligibleForRotation(e,t)));s.length>0&&this._startRotation(s),Rt("Scheduled positions",i.positionNames),i.positionNames.length>0&&this._scheduleInterval(e)}_isPositionEligibleForRotation(e,t){const i=this.schedulerRegistry[e],{rotationConfig:s,viewStartTimestamp:n,renderDone:o}=i,r=this.positionComponents[e];if(!o)return Rt(e,"RenderNotComplete"),!1;if(!this.#v.isVisible)return i.waitingToBeInView=!0,Rt(e,"PageHidden"),!1;if(!this.#v.hasFocus)return i.waitingToBeInView=!0,Rt(e,"PageNotFocused"),!1;if(r.hasMouseOver)return Rt(e,"MouseOver"),!1;if(r.isExpanded)return Rt(e,"Expanded"),!1;if(r.adClosed)return Rt(e,"AdClosed"),!1;if(s.requireViewable){if(!n)return Rt(e,"NotInView"),!1;const o=t-n;if(o<s.inViewDuration&&!i.waitingToBeInView)return Rt(e,"in view only for",o,"since",n),!1}return!0}_startRotation(e){const t=this._addRotationGroupComplements(e);t.forEach((e=>{const t=this.schedulerRegistry[e];t.rotationCount++,t.renderDone=!1,t.waitingToBeInView=!1,t.rotationCount>=t.rotationConfig.limit&&this.stopScheduling(e)})),Rt("Rotating",t),this.trigger(new Tt(Tt.ROTATION,{positionNames:t}))}_addRotationGroupComplements(e){let t=[];return(this.rotationConfig&&this.rotationConfig.groups||[]).forEach((i=>{i.forEach(((s,n)=>{G.isSubset(s,e)&&s.length>0&&(Rt("Whole group set to be rotated",s),i.forEach(((e,i)=>{i!==n&&(t=t.concat(e))})))}))})),G.removeDuplicates(e.concat(t))}_onPageVisibilityChange(){this._isPageActive()&&setTimeout((()=>{const e=Object.keys(this.schedulerRegistry).filter((e=>this.schedulerRegistry[e].waitingToBeInView&&this._isPositionEligibleForRotation(e)));e.length>0&&this._startRotation(e)}))}_isPageActive(){return this.#v.isVisible&&this.#v.hasFocus}_onPositionRenderStart(e){const t=e.meta.positionName;this.startScheduling(t)}_onPositionRenderDone(e){const t=this._getRegistryItemByPositionComponentEvent(e);t.renderDone=!0,e.target.isInView&&(t.viewStartTimestamp=(new Date).getTime())}_onNoAdForPosition(e){const t=e.meta.positionName,i=this.positionComponents[t];if(!i)return;i.position.config.client.rotation.onNoAd?this._onPositionRenderDone(e):this.stopScheduling(t)}_onPositionViewStart(e){this._getRegistryItemByPositionComponentEvent(e).viewStartTimestamp=(new Date).getTime()}_onPositionViewEnd(e){this._getRegistryItemByPositionComponentEvent(e).viewStartTimestamp=null}_getRegistryItemByPositionComponentEvent(e){const t=e.meta.positionName;return this.schedulerRegistry[t]}_togglePositionObservers(e,t){const i=t?"on":"off",s={RENDER_START:this._onPositionRenderStart,RENDER_COMPLETE:this._onPositionRenderDone,RENDER_FAILED:this._onPositionRenderDone,NO_AD:this._onNoAdForPosition,VIEW_START:this._onPositionViewStart,VIEW_END:this._onPositionViewEnd};Object.keys(s).forEach((t=>{const n=Xe[t],o=s[t];e[i](n,o,this)}))}}Object.assign(Pt.prototype,f);const yt=Pt;const It=class{apiStatus=de;usPrivacy=""};const Lt=class{apiStatus=de;applies=null;euconsent=""};class Nt extends e{static API_NOT_FOUND="UserRegulation.API_NOT_FOUND";static READ_TIMEOUT="UserRegulation.READ_TIMEOUT";static RESOLVED="UserRegulation.RESOLVED";static UPDATED="UserRegulation.UPDATED"}const xt="GDPR",Mt="CCPA";let Ft;class Ut{#J=0;#Y;#X=!1;#q={};#m;static getInstance(){return Ft=Ft||new Ut,Ft}static reset(){Ft=null}constructor(){this.#Y={CCPA:new It,GDPR:new Lt}}get data(){return this.#Y}get resolved(){return null===this.#J}resolve(e,t){if(t)return this.#J=null,this._setDataFromConfig(t),void(this.#X=!0);if(!this.#X){if(this.#X=!0,this.#m=e,"function"!=typeof this.#m.__uspapi&&"function"!=typeof this.#m.__tcfapi)return this.#Y.GDPR.apiStatus=this.#Y.CCPA.apiStatus=he,this.#J=null,void this.trigger(new Nt(Nt.API_NOT_FOUND));this._readRegulatoryData()}}_dispatchRegulationsResolvedEvent(){this.trigger(new Nt(Nt.RESOLVED))}_dispatchRegulationsUpdatedEvent(){this.trigger(new Nt(Nt.UPDATED))}_regulationResolved(e){this.#q[e]&&delete this.#q[e],0===Object.keys(this.#q).length&&(null===this.#J?this._dispatchRegulationsUpdatedEvent():(clearTimeout(this.#J),this.#J=null,this._dispatchRegulationsResolvedEvent()))}_setDataFromConfig(e){e.gdpr&&(e.gdpr.euconsent?(this.#Y.GDPR.applies=1,this.#Y.GDPR.euconsent=""+e.gdpr.euconsent):this.#Y.GDPR.applies=["","0","false",!1,0,void 0,null].includes(e.gdpr.applies)?0:1,this.#Y.GDPR.apiStatus=ue),e.ccpa&&e.ccpa.usPrivacy&&(this.#Y.CCPA.usPrivacy=""+e.ccpa.usPrivacy,this.#Y.CCPA.apiStatus=ue),this._dispatchRegulationsResolvedEvent()}_readCCPAData(){this.#m.__uspapi("getUSPData",1,((e,t)=>{this.#Y.CCPA.apiStatus=t?ge:ce,t&&(this.#Y.CCPA.usPrivacy=e.uspString||"",this._regulationResolved(Mt))}))}_readTCFv2Data(){this.#m.__tcfapi("addEventListener",2,((e,t)=>{"tcloaded"!==e.eventStatus&&"useractioncomplete"!==e.eventStatus||(this.#Y.GDPR.apiStatus=t?ge:ce,t&&(this.#Y.GDPR.applies=!1===e.gdprApplies?0:1,this.#Y.GDPR.euconsent=e.tcString||"",this._regulationResolved(xt)))}))}_readRegulatoryData(){this.#J=setTimeout((()=>{const e=Object.keys(this.#q);e.length>0?(e.forEach((e=>{this.#Y[e].apiStatus!==ce&&(this.#Y[e].apiStatus=le)})),this.trigger(new Nt(Nt.READ_TIMEOUT,{}))):this._dispatchRegulationsResolvedEvent(),this.#J=null}),500),"function"==typeof this.#m.__uspapi?this.#q[Mt]="_readCCPAData":this.#Y.CCPA.apiStatus=he,"function"==typeof this.#m.__tcfapi?this.#q[xt]="_readTCFv2Data":this.#Y.GDPR.apiStatus=he,Object.keys(this.#q).forEach((e=>{this[this.#q[e]]()}))}}Object.assign(Ut.prototype,f);const kt=Ut,zt=(e,t)=>{e?/^[a-f0-9]{64}$/gi.test(e||"")?t(e):((e,t)=>{if("string"==typeof e&&e)if(window.crypto&&crypto.subtle&&crypto.subtle.digest){const i=new TextEncoder("utf-8").encode(e.trim().toLowerCase());crypto.subtle.digest("SHA-256",i).then((e=>{const i=Array.from(new Uint8Array(e));t(i.map((e=>("00"+e.toString(16)).slice(-2))).join(""))}))}else t("");else t("")})(e,t):t(void 0)},Gt="yahoo-connectid",jt=function(e,t){if(!e||!t)return{};const i={};return t.forEach((t=>{void 0!==e[t]&&(i[t]=e[t])})),i},Vt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24;const t=new Date;return t.setHours(t.getHours()+e),t},Ht=()=>{try{return JSON.parse(localStorage.getItem(Gt))||{}}catch(e){return{}}},Bt=Ht,$t=function(){let{hashedEmail:e,hashedPuid:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=Ht();return!e&&!t||!e&&i.hashedEmail||e&&e===i.hashedEmail||!t&&i.hashedPuid||t&&t===i.hashedPuid?jt(i,["connectid"]):{}},Wt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Vt(e.ttl).getTime(),i={...jt(Ht(),["hashedEmail","hashedPuid"]),...jt(e,["hashedEmail","hashedPuid","connectid"]),expires:t};try{localStorage.setItem(Gt,JSON.stringify(i))}catch(e){}},Zt=()=>{try{localStorage.removeItem(Gt)}catch(e){}},Jt=(e,t,i)=>{let s=new XMLHttpRequest,n=Object.keys(t).map((e=>encodeURIComponent(e)+"="+encodeURIComponent(t[e]))).join("&");s.onreadystatechange=function(e){if(s.readyState===XMLHttpRequest.DONE)if(0===s.status||s.status>=200&&s.status<400)try{i(JSON.parse(s.responseText))}catch(e){i()}else i()};try{s.withCredentials=!0,s.open("GET",`${e}?${n}`,!0),s.send(t)}catch(e){}},Yt=e=>{(e=>{window.__uspapi?window.__uspapi("getUSPData",null,((t,i)=>{e(!0,t.uspString)})):e(!1)})(((t,i)=>{(e=>{window.__tcfapi?window.__tcfapi("addEventListener",2,((t,i)=>{i&&"error"!==t.cmpStatus?"tcloaded"!==t.eventStatus&&"useractioncomplete"!==t.eventStatus||e(!0,t.gdprApplies,t.tcString):e(!1)})):e(!1)})(((t,s,n)=>{e({uspString:i,gdprApplies:s,tcString:n})}))}))},Xt=e=>{let{pixelId:t,hashedEmail:i,hashedPuid:s}=e;if(!t)return!1;const{hashedEmail:n,hashedPuid:o,expires:r}=Bt();return(i||n||(s||o))&&(i&&i!==n||s&&s!==o||(!(a=r)||new Date(a).getTime()<Date.now()));var a},qt={syncIds:e=>{let{pixelId:t,hashedEmail:i,hashedPuid:s,yahoo1p:n}=e;Xt({pixelId:t,hashedEmail:i,hashedPuid:s})&&Yt((e=>{const o=Bt(),r=i||o.hashedEmail,a=s||o.hashedPuid,c=`https://ups.analytics.yahoo.com/ups/${t}/fed`,l={...r?{he:r}:{},...a?{puid:a}:{},...void 0!==e.gdprApplies?{gdpr:e.gdprApplies}:{},...void 0!==e.tcString?{gdpr_consent:e.tcString}:{},...void 0!==e.uspString?{us_privacy:e.uspString}:{},...void 0!==n?{"1p":n}:{}};Jt(c,l,(e=>{e&&Wt({...r?{hashedEmail:r}:{},...a?{hashedPuid:a}:{},connectid:e.connectid,ttl:e.ttl})}))}))}},Kt=qt,Qt=(e,t)=>{let{pixelId:i,email:s,puid:n,yahoo1p:o}=e;if((()=>{try{const e=window.localStorage.getItem("connectIdOptOut"),t=window.localStorage.getItem("_pbjs_id_optout"),i=window.localStorage.getItem("_pubcid_optout");return"1"===e||t||i}catch(e){return!1}})())return Zt(),void t({});zt(s,(e=>{zt(n,(s=>{Kt.syncIds({pixelId:i,hashedEmail:e,hashedPuid:s}),t($t({hashedEmail:e,hashedPuid:s}))}))}))},ei=Qt;"undefined"!=typeof exports&&(exports.getIds=Qt);class ti extends e{static TIMEOUT="TIMEOUT";static RESOLVED="RESOLVED";static UPDATED="UPDATED"}class ii{#X=!1;#J;#K={};resolve(e){const t=e.client.idProviders.yahoo;if(!t)return void(this.#J=null);if(this.#X)return;this.#X=!0;const i={yahoo1p:1,pixelId:t.pixelId,email:t.email};t.puid&&(i.puid=t.puid),this.#J=setTimeout((()=>{this.#J=null,this.trigger(new ti(ti.TIMEOUT))}),500),ei(i,(e=>{clearTimeout(this.#J),this.#J=null;const t=this.#K.CONNECTID,i=e.connectid;t&&t!==i?(this.#K.CONNECTID=i,this.trigger(new ti(ti.UPDATED))):(this.#K.CONNECTID=i,this.trigger(new ti(ti.RESOLVED)))}))}get resolved(){return null===this.#J}get ids(){return this.#K}}Object.assign(ii.prototype,f);const si=ii;class ni{static PAGE_LOAD="jac.inspect.page.pageLoad";static PING="jac.inspect.handshake.ping";static PONG="jac.inspect.handshake.pong";static POSITION_ADD="jac.inspect.position.add";static FETCH_BEGIN="jac.inspect.position.fetchBegin";static FETCH_COMPLETE="jac.inspect.position.fetchComplete";static FETCH_TIMEOUT="jac.inspect.position.fetchTimeout";static POSITION_ROTATE="jac.inspect.position.rotate";static POSITION_REMOVE="jac.inspect.position.remove";static POSITION_IN_VIEW="jac.inspect.position.inView";static POSITION_OUT_VIEW="jac.inspect.position.outView";static POSITION_RENDER_START="jac.inspect.position.renderStart";static POSITION_RENDER_COMPLETE="jac.inspect.position.renderComplete";static POSITION_COLLAPSED="jac.inspect.position.collapsed";static AD_LOAD_COMPLETE="jac.inspect.position.ad.loadComplete";static AD_SIZE_CHANGED="jac.inspect.position.ad.sizeChanged";static POSITION_CONFIG_CHANGED="jac.inspect.position.configChanged";static POSITION_AD_MARKUP_REQUESTED="jac.inspect.position.ad.markupRequested";static POSITION_AD_MARKUP="jac.inspect.position.ad.markup"}const oi=/\d\.\d\.\d(-rc\.\d{1,})?\/jac\.js$/;class ri{#Q;#ee;networkType;#te=!0;#m;constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;if(!e.performance)return X.warning("No performance support available"),void(this.#te=!1);this.#m=e;const t=e.navigator,i=t.connection||t.mozConnection||t.webkitConnection;this.networkType=i?i.effectiveType:"unknown";const s=e.performance;if(this.#Q=parseFloat(s.timing.navigationStart.toFixed(2)),this.#ee=parseFloat(s.timing.responseEnd.toFixed(2)),s.getEntriesByType){const e=s.getEntriesByType("navigation");e&&e[0]&&(this.#ee=parseFloat((e[0].responseEnd+this.#Q).toFixed(2)))}}getClientResourceTiming(){if(!this.#te)return;if(!this.#m.performance.getEntriesByType)return;const e=this.#m.performance.getEntriesByType("resource").filter((e=>e.name.match(oi)));return e.length>0?e[0]:void 0}getFetchResourceTiming(e){if(!this.#te||!e||!g.isString(e)||e.length<20)return;if(!this.#m.performance.getEntriesByType)return;const t=this.#m.performance.getEntriesByType("resource").filter((t=>"script"===t.initiatorType&&t.name===e));return t.length>0?t[t.length-1]:void 0}get responseEnd(){return this.#ee}get timeOrigin(){return this.#Q}}function ai(e){const t=[];let i=e;try{for(;i;)i=i.getRootNode(),i&&Node.DOCUMENT_FRAGMENT_NODE===i.nodeType?(i=i.host,i&&t.push(i.id||"")):i=i.parentNode}catch(e){X.error("Error occured while parsing the DOM hierarchy",e)}return t}function ci(e){let t,i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document,n=[],o=j.clone(e);return g.isString(o.client.targetElement)?(t=o.client.targetElement,i=s.getElementById(t)):g.isDOMNode(o.client.targetElement)&&(n=ai(e.client.targetElement),i=o.client.targetElement,o.client.targetElement=o.client.targetElement.toString(),o.input.client.targetElement=o.input.client.targetElement.toString(),t=i.id),{positionConfig:o,element:i,elementId:t,domContextIds:n}}class li{static createPongEvent(e,t,i){const s=(i=i||new ri).getClientResourceTiming(),n=e._config.service.site,o={topic:ni.PONG,meta:{timestamp:(new Date).getTime(),responseEnd:i.responseEnd,history:t,client:{version:e.version},adServer:{meta:{},params:{}},site:{spaceId:n.spaceId,name:n.name,category:n.category}}};s&&(o.meta.client.loadTime=s.responseEnd,o.meta.client.loadComplete=s.responseEnd+i.timeOrigin,o.meta.client.url=s.name);const r=e._config.service.adServer;return Object.keys(r).filter(((e,t)=>0===t)).forEach((e=>{const t=r[e];o.meta.adServer.name=e,o.meta.adServer.params=t.params,e!==ie.RAS&&e!==ie["1AS"]||(o.meta.adServer.meta.region=t.region,o.meta.adServer.revshare=t.revshare||"",o.meta.adServer.lmsid=t.lmsid||"")})),o}static createPositionAddEvent(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;const s=e._positions[t],{positionConfig:n,elementId:o,element:r,domContextIds:a}=ci(s.config,i),c=r?r.getBoundingClientRect().top:null;return{topic:ni.POSITION_ADD,meta:{timestamp:(new Date).getTime(),config:n,name:t,domContextIds:a,elementId:o,elementTop:c,sizes:s.config.service.sizes,containerType:s.containerType,params:s.config.service.params}}}static createFetchBeginEvent(e,t,i,s){return{topic:ni.FETCH_BEGIN,meta:{timestamp:s,name:e,url:t,prefetched:!!i}}}static createFetchTimeoutEvent(e,t){return{topic:ni.FETCH_TIMEOUT,meta:{timestamp:(new Date).getTime(),name:e,url:t}}}static createFetchCompleteEvent(e){let{jac:t,positionName:i,url:s,jillTimings:n,positionResponse:o,requestTimings:r}=e;const a=t._positions[i],c={meta:o.meta},l=o.content.crId,d=(a?a.config.service.alias:void 0)||o.alias;return{topic:ni.FETCH_COMPLETE,meta:{timestamp:(new Date).getTime(),name:i,url:s,upstreamResponseDuration:n.upstreamDuration,serviceResponseDuration:n.totalRequestDuration,totalServiceResponseDuration:r?r.duration:null,processingDuration:n.processingDuration,alias:d,creativeId:l,adData:c,status:o.status}}}static createPositionRotateEvent(e){return{topic:ni.POSITION_ROTATE,meta:{timestamp:(new Date).getTime(),name:e}}}static createPositionRemoveEvent(e){return{topic:ni.POSITION_REMOVE,meta:{timestamp:(new Date).getTime(),name:e}}}static createPositionInViewEvent(e){return{topic:ni.POSITION_IN_VIEW,meta:{timestamp:(new Date).getTime(),name:e}}}static createPositionOutOfViewEvent(e){return{topic:ni.POSITION_OUT_VIEW,meta:{timestamp:(new Date).getTime(),name:e}}}static createPositionRenderStartEvent(e,t){const i=e._positions[t];return{topic:ni.POSITION_RENDER_START,meta:{timestamp:(new Date).getTime(),name:t,timeout:i.config.client.render.timeout}}}static createPositionRenderCompleteEvent(e,t,i,s){const n=e._positions[t],o={topic:ni.POSITION_RENDER_COMPLETE,meta:{timestamp:(new Date).getTime(),name:t,containerType:n.containerType}};return void 0!==i&&void 0!==s&&(o.meta.size=i+"x"+s),o}static createAdSizeChangedEvent(e,t,i){const s={topic:ni.AD_SIZE_CHANGED,meta:{timestamp:(new Date).getTime(),name:e}};return void 0!==t&&void 0!==i&&(s.meta.size=t+"x"+i),s}static createAdLoadCompleteEvent(e){return{topic:ni.AD_LOAD_COMPLETE,meta:{timestamp:(new Date).getTime(),name:e}}}static createPageLoadEvent(e){return{topic:ni.PAGE_LOAD,meta:{timestamp:e}}}static createPositionCollapsedEvent(e){return{topic:ni.POSITION_COLLAPSED,meta:{timestamp:(new Date).getTime(),name:e}}}static createPositionConfigChangedEvent(e,t){return{topic:ni.POSITION_CONFIG_CHANGED,meta:{timestamp:(new Date).getTime(),name:e,config:ci(t).positionConfig}}}static createPositionAdMarkupEvent(e,t){return{topic:ni.POSITION_AD_MARKUP,meta:{timestamp:(new Date).getTime(),name:e,markup:t}}}}class di{#ie;#se;#ne=[];#oe={};get history(){return this.#ne}activate(t,i){this.#se=i;const s=Z.getParameter(t.location.href,"jac.inspect");if("1"===s)this._launchInspector();else if("2"===s){const e="?jac.newWindow=true";this._launchInspector(e)}this.on(ni.PING,this._onPing,this),this.on(ni.POSITION_AD_MARKUP_REQUESTED,this._onMarkupRequested,this),this._initInternalListeners(i),t.addEventListener("message",(t=>{const{topic:i}=t.data;i!==ni.PING&&i!==ni.POSITION_AD_MARKUP_REQUESTED||this.trigger(new e(i,{source:t.source,...t.data.meta}))}))}produceEvent(e){this.#ie?this.#ie.postMessage(e,"*"):this.#ne.push(e)}_launchInspector(e){e=e||"";const t=document.createElement("script");t.src="https://s.yimg.com/ap/jacky/bootstrap/jacky-bootstrap.min.js"+e,document.head.appendChild(t)}_initInternalListeners(e){e.on(Me.POSITION_CREATED,this._onPositionCreated,this),e._jill.on(je.FETCH_START,this._onFetchStart,this),e._jill.on(je.RESPONSE_PROCESSED,this._onJillResponseProcessed,this),e._jill.on(je.FETCH_TIMEOUT,this._onJillFetchTimeout,this),e.on(Me.POSITION_ROTATE,this._onPositionRotate,this),e.on(Me.POSITION_VIEW_START,this._onPositionViewStart,this),e.on(Me.POSITION_VIEW_END,this._onPositionViewEnd,this),e.on(Me.POSITION_RENDER_START,this._onPositionRenderStart,this),e.on(Me.POSITION_RENDER_COMPLETE,this._onPositionRenderComplete,this),e.on(Me.POSITION_COLLAPSED,this._onPositionCollapsed,this),e.on(Me.AD_LOAD_COMPLETE,this._onAdLoadComplete,this),e.on(Me.AD_SIZE_CHANGED,this._onAdSizeChanged,this),e._pageObserver.on(t.LOADED,this._onPageLoad,this),e.on(Me.POSITION_CONFIG_CHANGED,this._onPositionConfigChanged,this)}_onPing(e){const t=this.#se._config;t&&t.service?this.#ie?X.warning("Already responded to the ping request."):(this.#ie=e.meta.source,this._sendPong()):X.warning("No config set yet. Can not reply to inspect ping requests.")}_onMarkupRequested(e){e.meta&&e.meta.name?this.#ie?this.#oe[e.meta.name]&&this.produceEvent(li.createPositionAdMarkupEvent(e.meta.name,this.#oe[e.meta.name])):X.warning("No ping initialization request got."):X.warning("No position name provided in the ad markup request.")}_sendPong(){const e=li.createPongEvent(this.#se,this.#ne);this.produceEvent(e),this.#ne=[]}_onPositionCreated(e){this.produceEvent(li.createPositionAddEvent(this.#se,e.meta.positionName))}_onFetchStart(e){const t=e.meta.url,i=e.meta.prefetched,s=(new Date).getTime();Object.keys(e.meta.request.positions).forEach((e=>{this.produceEvent(li.createFetchBeginEvent(e,t,i,s))}))}_onJillFetchTimeout(e){const t=e.meta.url;e.meta.positionNames.forEach((e=>{this.produceEvent(li.createFetchTimeoutEvent(e,t))}))}_onJillResponseProcessed(e){const t=e.meta.url,i=e.meta.response,s=i.positions,n=i.service.timings||{};i.adServer&&(n.upstreamDuration=i.adServer.requestDuration);const o=this.#se,r=(new ri).getFetchResourceTiming(t);Object.keys(s).forEach((e=>{this.#oe[e]=s[e][0].content.markup,this.produceEvent(li.createFetchCompleteEvent({jac:o,positionName:e,url:t,jillTimings:n,positionResponse:s[e][0],requestTimings:r}))}))}_onPositionRotate(e){this.produceEvent(li.createPositionRotateEvent(e.meta.positionName))}_onPositionViewStart(e){this.produceEvent(li.createPositionInViewEvent(e.meta.positionName))}_onPositionViewEnd(e){this.produceEvent(li.createPositionOutOfViewEvent(e.meta.positionName))}_onPositionRenderStart(e){this.produceEvent(li.createPositionRenderStartEvent(this.#se,e.meta.positionName))}_onPositionRenderComplete(e){this.produceEvent(li.createPositionRenderCompleteEvent(this.#se,e.meta.positionName,e.meta.width,e.meta.height))}_onAdLoadComplete(e){this.produceEvent(li.createAdLoadCompleteEvent(e.meta.positionName))}_onAdSizeChanged(e){this.produceEvent(li.createAdSizeChangedEvent(e.meta.positionName,e.meta.width,e.meta.height))}_onPageLoad(e){this.produceEvent(li.createPageLoadEvent(e.meta.timestamp))}_onPositionCollapsed(e){this.produceEvent(li.createPositionCollapsedEvent(e.meta.positionName))}_onPositionConfigChanged(e){this.produceEvent(li.createPositionConfigChangedEvent(e.meta.positionName,e.meta.config))}get adHistory(){return this.#oe}}Object.assign(di.prototype,f);const hi=di;class ui extends e{static COUNTER="Collector.COUNTER";static DURATION="Collector.DURATION";constructor(e,t){super(e),this.meta=t}}const gi={JacLoadDelay:"JacLoadDelay",FetchDelay:"FetchDelay",FetchTimeoutCount:"FetchTimeoutCount",FetchNetworkDuration:"FetchNetworkDuration",PositionFetchDuration:"PositionFetchDuration",PositionRenderDelay:"PositionRenderDelay",PositionRenderDuration:"PositionRenderDuration",PositionViewableDelay:"PositionViewableDelay",AdLoadDuration:"AdLoadDuration",PositionFetchErrorCount:"PositionFetchErrorCount",PositionAdClosedCount:"PositionAdClosedCount",PositionAdOpenedCount:"PositionAdOpenedCount"},pi=[gi.FetchTimeoutCount];function mi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t?`${e}_${JSON.stringify(t)}`:e}function Ei(e){return e.split("_")[0]}class fi{#se;#re;#ae={};#ce={};#le={};#de={};#he={};#ue;#ee;#ge;#pe;#me;constructor(e,t){this.#se=e,this.#re=t||new ri,this.#ue=this.#re.networkType,this.#ee=this.#re.responseEnd,this.#pe=gi,this.#me=!0}start(){this._toggleEventListeners(!0);const e={networkType:this.#ue};this.markDurationStart(gi.JacLoadDelay,e,this.#ee),this.#ge=(new Date).getTime(),this.markDurationEnd(gi.JacLoadDelay,e,this.#ge)}stop(){this._toggleEventListeners(!1)}setActiveMetrics(e){this.#pe={},e.forEach((e=>this.#pe[e]=gi[e]));const t=this.#se;this.#pe[gi.FetchDelay]||this.#pe[gi.PositionFetchDuration]||t._jill.off(je.FETCH_START,this._onFetchStart,this),this.#pe[gi.FetchNetworkDuration]||t._jill.off(je.FETCH_COMPLETE,this._onJillFetchComplete,this),this.#pe[gi.PositionFetchDuration]||this.#pe[gi.PositionRenderDelay]||t.off(Me.FETCH_COMPLETE,this._onFetchComplete,this),this.#pe[gi.FetchTimeoutCount]||t.off(Me.FETCH_TIMEOUT,this._onFetchTimeout,this),this.#pe[gi.PositionRenderDelay]||this.#pe[gi.PositionRenderDuration]||t.off(Me.POSITION_RENDER_START,this._onPositionRenderStart,this),this.#pe[gi.PositionRenderDuration]||this.#pe[gi.PositionViewableDelay]||this.#pe[gi.AdLoadDuration]||t.off(Me.POSITION_RENDER_COMPLETE,this._onPositionRenderComplete,this),this.#pe[gi.PositionViewableDelay]||t.off(Me.POSITION_VIEWABLE,this._onPositionViewable,this),this.#pe[gi.AdLoadDuration]||t.off(Me.AD_LOAD_COMPLETE,this._onAdLoadComplete,this),this.#pe[gi.PositionFetchErrorCount]||t.off(Me.FETCH_ERROR,this._onFetchError,this),this.#pe[gi.PositionAdClosedCount]||t.off(Me.AD_CLOSED,this._onAdClosed,this),this.#pe[gi.PositionAdOpenedCount]||t.off(Me.AD_OPENED,this._onAdOpened,this),this._cleanNonActiveCollectedMetrics()}_cleanNonActiveCollectedMetrics(){Object.keys(this.#ce).forEach((e=>{const t=Ei(e);this.#pe[t]||delete this.#ce[e]})),Object.keys(this.#le).forEach((e=>{const t=Ei(e);this.#pe[t]||delete this.#le[e]}))}get durations(){let e=this.#me?this.#de:this.#ce;return Object.keys(e).reduce(((t,i)=>t.concat(e[i])),[])}get counters(){let e=this.#me?this.#he:this.#le;return Object.keys(e).map((t=>e[t]))}flush(){this.#me?(this.#de={},this.#he={}):(this.#ce={},this.#le={})}markDurationStart(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.#pe[e])return;i=i||(new Date).getTime();const s=mi(e,t);this.#ae[s]&&X.warning(`${s} duration metric already started.`),this.#ae[s]={name:e,startTime:i,dimensions:t}}markDurationEnd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.#pe[e])return;i=i||(new Date).getTime();const s=mi(e,t);if(!this.#ae[s])return void X.error(`${s} duration metric not started.`);const n=this.#ae[s];n.endTime=i,n.duration=parseFloat((n.endTime-n.startTime).toFixed(2));const o=pi.includes(e);this.#me&&o?(this.#de[s]=this.#de[s]||[],this.#de[s].push(n)):(this.#ce[s]=this.#ce[s]||[],this.#ce[s].push(n)),delete this.#ae[s],this.#me&&!o||this._notifyMetricEvent(new ui(ui.DURATION,n))}incrementCounter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.#pe[e])return;const i=mi(e,t),s=pi.includes(e),n=this.#me&&s?this.#he:this.#le,o=n[i]=n[i]||{name:e,count:0,dimensions:t};o.count++,this.#me&&!s||this._notifyMetricEvent(new ui(ui.COUNTER,o))}disableBufferMode(){this.#me=!1}_onFetchStart(e){const t=Object.keys(e.meta.request.positions),i=this.#ue;this.durations[gi.FetchDelay]||(this.markDurationStart(gi.FetchDelay,{networkType:i},this.#ge),this.markDurationEnd(gi.FetchDelay,{networkType:i})),t.forEach((e=>{this.markDurationStart(gi.PositionFetchDuration,{positionName:e,networkType:i})}))}_onJillFetchComplete(e){const t=e.meta.url,i=this.#re.getFetchResourceTiming(t);if(i&&i.duration){const e=this.#ue;this.markDurationStart(gi.FetchNetworkDuration,{networkType:e},i.startTime),this.markDurationEnd(gi.FetchNetworkDuration,{networkType:e},i.responseEnd)}}_onFetchComplete(e){const t=e.meta.positionNames,i=this.#ue;t.forEach((e=>{this.markDurationEnd(gi.PositionFetchDuration,{positionName:e,networkType:i}),this.markDurationStart(gi.PositionRenderDelay,{positionName:e,networkType:i})}))}_onFetchTimeout(){this.incrementCounter(gi.FetchTimeoutCount)}_onPositionRenderStart(e){const t=e.meta.positionName,i=this.#ue,s=mi(gi.PositionRenderDelay,{positionName:t,networkType:i});this.#ae[s]&&this.markDurationEnd(gi.PositionRenderDelay,{positionName:t,networkType:i}),this.markDurationStart(gi.PositionRenderDuration,{positionName:t,networkType:i})}_onPositionRenderComplete(e){const t=e.meta.positionName,i=this.#ue;this.markDurationEnd(gi.PositionRenderDuration,{positionName:t,networkType:i}),this.markDurationStart(gi.AdLoadDuration,{positionName:t,networkType:i}),this.markDurationStart(gi.PositionViewableDelay,{positionName:t})}_onPositionViewable(e){const t=e.meta.positionName;this.markDurationEnd(gi.PositionViewableDelay,{positionName:t})}_onAdLoadComplete(e){const t=e.meta.positionName,i=this.#ue;this.markDurationEnd(gi.AdLoadDuration,{positionName:t,networkType:i})}_onFetchError(e){e.meta.positionNames.forEach((e=>{this.incrementCounter(gi.PositionFetchErrorCount,{positionName:e})}))}_onAdClosed(e){this._incrementCounterPerPosition(e,gi.PositionAdClosedCount)}_onAdOpened(e){this._incrementCounterPerPosition(e,gi.PositionAdOpenedCount)}_notifyMetricEvent(e){setTimeout((()=>{this.trigger(e)}),0)}_incrementCounterPerPosition(e,t){const i=e.meta.positionName;this.incrementCounter(t,{positionName:i})}_toggleEventListeners(){const e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?"on":"off",t=this.#se;t._jill[e](je.FETCH_START,this._onFetchStart,this),t._jill[e](je.FETCH_COMPLETE,this._onJillFetchComplete,this),t[e](Me.FETCH_COMPLETE,this._onFetchComplete,this),t[e](Me.FETCH_TIMEOUT,this._onFetchTimeout,this),t[e](Me.POSITION_RENDER_START,this._onPositionRenderStart,this),t[e](Me.POSITION_RENDER_COMPLETE,this._onPositionRenderComplete,this),t[e](Me.POSITION_VIEWABLE,this._onPositionViewable,this),t[e](Me.AD_LOAD_COMPLETE,this._onAdLoadComplete,this),t[e](Me.FETCH_ERROR,this._onFetchError,this),t[e](Me.AD_CLOSED,this._onAdClosed,this),t[e](Me.AD_OPENED,this._onAdOpened,this)}}Object.assign(fi.prototype,f);const _i=typeof $METRIC_HOST$!==d?$METRIC_HOST$:"https://jill.fc.yahoo.com/",Ai="undefined"!=typeof $JAC_METRICS_QUEUE_DELAY$?$JAC_METRICS_QUEUE_DELAY$:5e3;class Ci{#Ee;#fe;#f;#_e={};#Ae=!1;#Ce;#m;constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window;this.#Ee=e;const s=i.JAC_CONFIG||{};let n,o;s.service&&s.service.site&&(n=s.service.site.name,o=s.service.site.category),this.setGlobalTags({siteName:n,siteCategory:o}),this.#fe=`${_i}v1/client/m`,this.#f=t.version,this.#m=i}activate(){this.#Ce||(this.#Ee.on(ui.COUNTER,this._enqueueReport,this),this.#Ee.on(ui.DURATION,this._enqueueReport,this),this.#Ce=()=>this.report(),this.#m.addEventListener("unload",this.#Ce))}deactivate(){this.#Ce&&(this.#Ee.off(ui.COUNTER,this._enqueueReport,this),this.#Ee.off(ui.DURATION,this._enqueueReport,this),this.#m.removeEventListener("unload",this.#Ce),this.#Ce=null)}setGlobalTags(e){let{siteName:t,siteCategory:i}=e;this.#_e={...this.#_e,siteName:t,siteCategory:i}}report(){const e=this.#Ee.durations.map((e=>({type:"duration",value:e.duration,name:e.name,tags:e.dimensions||void 0}))),t=this.#Ee.counters.map((e=>({type:"count",value:e.count,name:e.name,tags:e.dimensions||void 0}))),i=e.concat(t);if(i.length<=0)return;const s=JSON.stringify({jacVersion:this.#f,tags:this.#_e||void 0,metrics:i});"function"==typeof this.#m.navigator.sendBeacon?this.#m.navigator.sendBeacon(this.#fe,s):(new this.#m.Image).src=`${this.#fe}?data=${encodeURIComponent(s)}`,this.#Ee.flush()}_enqueueReport(){this.#Ae||(this.#Ae=!0,setTimeout((()=>{this.report(),this.#Ae=!1}),Ai))}get jacVersion(){return this.#f}get collector(){return this.#Ee}get globalTags(){return this.#_e}get beaconUrl(){return this.#fe}}Object.assign(Ci.prototype,f);const wi={ar:{closeAdLabel:" ",showAdLabel:" "},bg:{closeAdLabel:" ",showAdLabel:" "},bn:{closeAdLabel:" ",showAdLabel:" "},cs:{closeAdLabel:"Zavt reklamu",showAdLabel:"Zobrazit reklamu"},da:{closeAdLabel:"Luk annonce",showAdLabel:"Vis annonce"},de:{closeAdLabel:"Werbung schlieen",showAdLabel:"Werbung anzeigen"},el:{closeAdLabel:"",showAdLabel:""},en:{closeAdLabel:"Close ad",showAdLabel:"Show ad"},es:{closeAdLabel:"Cerrar anuncio",showAdLabel:"Mostrar anuncio"},et:{closeAdLabel:"Sule reklaam",showAdLabel:"Nita reklaami"},fi:{closeAdLabel:"Sulje mainos",showAdLabel:"Nyt mainos"},fil:{closeAdLabel:"Isara ang Ad",showAdLabel:"Ipakita ang Ad"},fr:{closeAdLabel:"Fermer l'annonce",showAdLabel:"Afficher la pub"},"fr-ca":{closeAdLabel:"Fermer la publicit",showAdLabel:"Afficher la pub"},gr:{closeAdLabel:"",showAdLabel:""},gu:{closeAdLabel:"  ",showAdLabel:" "},he:{closeAdLabel:" ",showAdLabel:" "},hi:{closeAdLabel:"  ",showAdLabel:" "},hr:{closeAdLabel:"Zatvori oglas",showAdLabel:"Pokai oglas"},hu:{closeAdLabel:"Hirdets bezrsa",showAdLabel:"Hirdets megjelentse"},id:{closeAdLabel:"Tutup Iklan",showAdLabel:"Tampilkan Iklan"},it:{closeAdLabel:"Chiudi annuncio",showAdLabel:"Mostra annuncio"},ja:{closeAdLabel:"",showAdLabel:""},kn:{closeAdLabel:" ",showAdLabel:" "},ko:{closeAdLabel:" ",showAdLabel:" "},lt:{closeAdLabel:"Udaryti reklam",showAdLabel:"Rodyti reklam"},lv:{closeAdLabel:"Aizvrt reklmu",showAdLabel:"Rdt reklmu"},ml:{closeAdLabel:" ",showAdLabel:" "},mr:{closeAdLabel:"  ",showAdLabel:" "},ms:{closeAdLabel:"Tutup ad",showAdLabel:"Tunjukkan Iklan"},nb:{closeAdLabel:"Lukk annonse",showAdLabel:"Vis annonse"},no:{closeAdLabel:"Lukk annonse",showAdLabel:"Vis annonse"},nl:{closeAdLabel:"Advertentie sluiten",showAdLabel:"Advertentie weergeven"},"nl-be":{closeAdLabel:"Advertentie sluiten",showAdLabel:"Advertentie tonen"},pl:{closeAdLabel:"Zamknij reklam",showAdLabel:"Wywietl reklam"},pt:{closeAdLabel:"Fechar anncio",showAdLabel:"Mostrar anncio"},ro:{closeAdLabel:"nchide",showAdLabel:"Deschide"},ru:{closeAdLabel:" ",showAdLabel:" "},sk:{closeAdLabel:"Zavrie reklamu",showAdLabel:"Zobrazi reklamu"},sl:{closeAdLabel:"Zapri oglas",showAdLabel:"Pokai oglas"},sr:{closeAdLabel:" ",showAdLabel:" "},sv:{closeAdLabel:"Stng",showAdLabel:"ppna"},ta:{closeAdLabel:" ",showAdLabel:" "},te:{closeAdLabel:" ",showAdLabel:" "},th:{closeAdLabel:"",showAdLabel:""},tr:{closeAdLabel:"Reklam Kapat",showAdLabel:"Reklam Gster"},tw:{closeAdLabel:"",showAdLabel:""},uk:{closeAdLabel:" ",showAdLabel:" "},ur:{closeAdLabel:"  ",showAdLabel:" "},vi:{closeAdLabel:"ng Qung co",showAdLabel:"Hin th Qung co"},zh:{closeAdLabel:"",showAdLabel:""},"zh-cn":{closeAdLabel:"",showAdLabel:""},"zh-hk":{closeAdLabel:"",showAdLabel:""},"zh-tw":{closeAdLabel:"",showAdLabel:""}},Oi={DEFAULT_RESOURCE:wi.en,getLocalResourceBundle(){const e=(navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage).toLowerCase();return wi[e]||wi.en}},vi={createFromJillResponse(e,t,i){const s=t.positions,n=Oi.getLocalResourceBundle();return e.reduce(((e,o)=>{const r=i.positions[o],a=s[o]?s[o][0]:null;if(!r||!a)return X.warning(`Position ${o} is not valid to be processed from the response.`),e;a.config=j.clone(r),a.config.client.closeButton.labels={close:n.closeAdLabel,show:n.showAdLabel};const c=r.input.client.closeButton||{};j.copy(r.client.closeButton.labels,a.config.client.closeButton.labels,!0),j.copy(c.labels||{},a.config.client.closeButton.labels);const l=r.service.sizes;if(g.isString(l)){if(!g.isObject(pe)||!pe[l])return void X.warning(`Position ${o} size mapping lookup failure.`);a.config.service.sizes=pe[l]}a.meta=a.meta||{};const d=t.adServer;return d&&d.exclusionStatus&&(a.exclusionStatus=d.exclusionStatus),a.timestamp=(new Date).getTime(),a.meta.isMobileMoment=k.isMobileMomentAd(a),e[o]=a,e}),{})},createFromTimeout:(e,t)=>e.reduce(((e,i)=>{const s=t.positions[i];return s?(e[i]={status:re,content:{},config:s,meta:{},timestamp:(new Date).getTime()},e):(X.warning(`Timeout for a non-existing position ${i} received.`),e)}),{}),createFromContent(e){const t=e.client.content;return t&&t.markup?(e.service.sizes=e.service.sizes||[`${t.size.width}x${t.size.height}`],{status:ne,content:{markup:t.markup,size:{...t.size,unit:se}},config:e,meta:{},timestamp:(new Date).getTime()}):null}};function Si(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;const i=t.document,s=i.createElement("iframe");s.src=e,P.setStyles(s,{display:"none",border:"none",width:0,height:0}),i.body.appendChild(s)}class Ti extends Be{static ACTION_NAME="render"}const bi="string"!==d?"1.5.0":"0.0.0",Di={},Ri=new Ye(bi),Pi=new A,yi=new St,Ii=new yt(Pi),Li=kt.getInstance(),Ni=new si,xi=new hi,Mi=new class{collector;reporter;#we;init(e){this.collector=new fi(e),this.reporter=new Ci(this.collector,e),this.reporter.activate(),this.collector.start()}processMetricsEnableStatus(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=((null==i||null===(e=i.metrics)||void 0===e?void 0:e.samplingPercent)||0)>=g.getRandomInt(1,100),n=(null==i||null===(t=i.metrics)||void 0===t?void 0:t.samplingRateExempt)||[];g.isSet(this.#we)||(this.#we=!1!==s||n.length>0,this.collector&&(this.collector.disableBufferMode(),!s&&n.length>0&&this.collector.setActiveMetrics(n),this.#we||this.collector.stop()))}configUpdated(e){const t=e.service.site||{},i=t.name,s=t.category;this.reporter.setGlobalTags({siteName:i,siteCategory:s})}},Fi=new class{createRotationConfig(e,t){const i=j.clone(e.client.rotation);if(!i.enabled)return;this._shouldRotateFromComments(t)||(i.enabled=!1);const s=this._getEnvironmentRotationInfo(e,t);return s.RefreshTime&&(i.period=1e3*s.RefreshTime),s.RefreshMax&&(i.limit=s.RefreshMax),s.RefreshKeepSize&&(i.resizable="N"===s.RefreshKeepSize),i}getRotationAliasBasedOnSize(e,t){return t=t||e.content.size,this._isCommentPresent(e,Ne)&&!this._isLargeAd(t)?e.meta.RefreshSmall:this._isCommentPresent(e,xe)&&this._isLargeAd(t)?e.meta.RefreshLarge:void 0}_shouldRotateFromComments(e){const t=e.meta,i=t.AdTypePriority?parseInt(t.AdTypePriority):-1;return!("N"===t.RefreshExclusive&&"N"===t.MP&&i>=493||"N"===t.RefreshReserved&&"N"===t.MP&&i>=200&&i<493)&&(this._isCommentPresent(e,"RefreshMN")||this._isCommentPresent(e,Ne)&&!this._isLargeAd(e.content.size)||this._isCommentPresent(e,xe)&&this._isLargeAd(e.content.size))}_getEnvironmentRotationInfo(e,t){const i={RefreshTime:t.meta.RefreshTime,RefreshMax:t.meta.RefreshMax,RefreshKeepSize:t.meta.RefreshKeepSize};i.RefreshTime=i.RefreshTime?parseInt(i.RefreshTime):void 0,i.RefreshMax=i.RefreshMax?parseInt(i.RefreshMax):void 0;const s={},n=e.input.client&&e.input.client.rotation;return n&&(n.period&&n.period>Le.MINIMUM_ROTATION_INTERVAL&&(s.RefreshTime=n.period/1e3),n.limit&&(s.RefreshMax=n.limit),g.isSet(n.resizable)&&(s.RefreshKeepSize=n.resizable?"N":"Y")),Object.assign(i,s)}_isCommentPresent(e,t){return!!e.meta[t]}_isLargeAd(e){return e.width>=970||e.height>=600}},Ui=new class{userRegulations;windowContext;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;this.userRegulations=e,this.windowContext=t}injectTrackers(e){!e||e.opus?this._onUserRegulationsResolved((()=>this._injectOpusTag())):e&&e.smartPixel&&this._injectSmartPixelTag(),e&&e.msftSync&&((new Image).src="https://cms.analytics.yahoo.com/cms?partner_id=MSFT")}_onUserRegulationsResolved(e){this.userRegulations.resolved?e():(this.userRegulations.on(Nt.RESOLVED,e),this.userRegulations.on(Nt.READ_TIMEOUT,e),this.userRegulations.on(Nt.API_NOT_FOUND,e))}_injectOpusTag(){const e=Z.removeParameters(this.windowContext.document.referrer);Si(`https://opus.analytics.yahoo.com/tag/opus-frame.html?referrer=${encodeURIComponent(e)}`,this.windowContext)}_injectSmartPixelTag(){const e=Z.removeParameters(this.windowContext.document.referrer);Si(`https://tag.idsync.analytics.yahoo.com/sp-frame.html?referrer=${encodeURIComponent(e)}`,this.windowContext)}}(Li);function ki(e,t,i){if(!Array.isArray(t)||0===t.length)return X.warning(`Invalid array of position names used with JAC.${e}()`),{result:!1,validPositionNames:[]};const s=t.filter((e=>Yi._config.positions[e]&&(!i||i(e))));if(0===s.length)return X.warning(`JAC.${e}() aborted because there are no valid positions.`),{result:!1,validPositionNames:s};if(s.length!==t.length){const i=G.diff(t,s);X.warning(`JAC.${e}() failed for the following positions`,i)}return{result:!0,validPositionNames:s}}function zi(e){!function(e){Li.resolved?e():(Li.on(Nt.RESOLVED,e),Li.on(Nt.READ_TIMEOUT,e),Li.on(Nt.API_NOT_FOUND,e))}((()=>{!function(e){Ni.resolved?e():(Ni.on(ti.RESOLVED,e),Ni.on(ti.TIMEOUT,e))}(e)}))}function Gi(e,t){Yi.trigger(new Me(e,Object.assign({},t)))}function ji(e){Gi(Me.POSITION_CONFIG_CHANGED,{positionName:e.target.name,config:e.meta})}function Vi(e,t){const i=Object.assign({},t,e.meta),s=e.meta.positionName,n=Yi._positions[s].render;e.type===Xe.RENDER_COMPLETE?(n.completePosition(s),Gi(Me.POSITION_RENDER_COMPLETE,i)):e.type===Xe.RENDER_FAILED&&(n.abortPosition(s),Gi(Me.POSITION_RENDER_FAILED,i)),n.positionNames.length<=0&&(n.end(),Gi(Me.RENDER_COMPLETE,{positionNames:n.completedPositionNames}))}function Hi(e){const t=e.service&&e.service.user?e.service.user.regs:void 0;Li.resolve(window,t),Li.resolved&&qi(),Ni.resolved&&Ki()}function Bi(e,t,i){zi((()=>{e.isAborted()?X.warning("Fetch was aborted for positions",e.abortedPositionNames):(e.start(),Gi(Me.FETCH_START,{positionNames:e.positionNames}),Ri.fetchAds(e,t,i))}))}function $i(e,t){const i=t.filter((t=>{const i=Yi._positions[t];if(i){const s=i.config.client[e].auto,n=Ji(t),o=i[e]&&i[e].isPending(t);return s&&!o&&n===(e===Ti.ACTION_NAME)}return!1}));i.length>0&&Yi[e](i)}function Wi(e){$i($e.ACTION_NAME,e)}function Zi(e){$i(Ti.ACTION_NAME,e)}function Ji(e){const t=Di[e];if(!t)return!1;const i=Yi._positions[e].config.client.fetch.cacheTTL;return!i||(new Date).getTime()-t.timestamp<i}const Yi={_jill:Ri,_scheduler:Ii,_pageObserver:Pi,_pageProtection:yi,_userRegulations:Li,_userIdentity:Ni,_inspectHandler:xi,_adRotationFactory:Fi,_trackersManager:Ui,_instrumentationController:Mi,_adData:Di,_positions:{},_positionComponents:{},_config:null,_serverSideConfig:null,_onReadyExecuted:!1,_globalConfigProcessed:!1,processQueue(){Yi._config?Ri.process():X.warning("Jill response can not be processed without a config set.")},get version(){return bi},setConfig(e){const t=e;this._config=new Ge(e,this._serverSideConfig),Hi(t);const i=this._config.client.positions;if(i){Object.keys(this._positions).filter((e=>!i[e])).forEach((e=>this.destroyPosition(e))),Object.keys(i).forEach((e=>{const t=this._config.positions[e];this._createPosition(e,t)}))}Mi.processMetricsEnableStatus(this._config.client),Mi.configUpdated(this._config),Ii.applyGlobalRotationConfig(this._config.client.rotation),yi.init(Pi,this,window),function(e){if(e.client&&g.isFunction(e.client.onReady)&&!Yi._onReadyExecuted){Yi._globalConfigProcessed&&X.warning("JAC: Support for onReady hook with JAC.setConfig() has been deprecated and will be removed in the future versions. Please move the code from onReady hook to be executed before JAC.setConfig(). Also, setting the onReady hook inside global JAC_CONFIG variable before JAC is loaded still continues to be supported.");const t=e.client.onReady;try{t()}catch(e){X.error("Error while calling JAC_CONFIG.onReady():",e)}Yi._onReadyExecuted=!0}}(t),this.processQueue();const s=Object.keys(i);Wi(s),this._pageObserver.domLoaded&&Zi(s)},getConfig(){return this._config?this._config.clone():void 0},updateConfig(e,t){if(!this._config)return void X.warning("JAC Config has not been set.");const i=Yi.getConfig();if(this._config.updateConfigSection(e,t))if(0===e.indexOf(Ge.CLIENT_POSITIONS_PROPERTY))if(e===Ge.CLIENT_POSITIONS_PROPERTY)Yi.setConfig(this._config.input);else{const t=this._config.getPositionNameFromConfigPath(e);Ii.applyGlobalRotationConfig(this._config.client.rotation),function(e,t){const i=Yi._config.client.positions[e],s=i.fetch.auto,n=Yi._config.positions[e];Yi._createPosition(e,n),s&&!t.fetch.auto?Wi([e]):i.render.auto&&!t.render.auto&&Pi.domLoaded&&Zi([e])}(t,i.client.positions[t])}else 0===e.indexOf(Ge.SERVICE_PROPERTY)&&(Mi.configUpdated(this._config),Hi(this._config.input))},createPosition(e,t){if(!g.isString(e))return void X.warning(`Non-string positionName found that is ignored: ${e}.`);if(!this._config)return void X.warning("JAC Config has not been set.");this._config.updatePosition(e,t);const i=this._config.positions[e];this._createPosition(e,i);const s=[e];Wi(s),this._pageObserver.domLoaded&&Zi(s)},_createPosition(e,t){let i=this._positions[e];if(i?i.update(t):(this._positions[e]=i=new Ae(e,t),i.on(me.CONFIG_UPDATE,ji),Gi(Me.POSITION_CREATED,{positionName:e})),i.config.client.rotation.enabled&&!Ii.isPositionRegistered(e)){Ii.register(i);const t=this._positionComponents[e];t&&Ii.subscribe(t)}this._config.verifyPositionConfig(e);const s=t.client.content;if(s&&s.markup){const s=vi.createFromContent(t);i.applyAdData(s),Di[e]=s}return i},_createPositionComponent(e){const t=e.name,i=new Ot(e,this._pageObserver),s={positionName:t},n={[Xe.RENDER_START]:()=>{Gi(Me.POSITION_RENDER_START,s)},[Xe.RENDER_COMPLETE]:e=>{Vi(e,s)},[Xe.RENDER_FAILED]:e=>{Vi(e,s)},[Xe.VIEW_START]:()=>{Gi(Me.POSITION_VIEW_START,s)},[Xe.VIEW_END]:()=>{Gi(Me.POSITION_VIEW_END,s)},[Xe.VIEWABLE]:()=>{Gi(Me.POSITION_VIEWABLE,s)},[Xe.AD_LOAD]:()=>{Gi(Me.AD_LOAD_COMPLETE,s)},[Xe.AD_LOAD_TIMEOUT]:()=>{Gi(Me.AD_LOAD_TIMEOUT,s)},[Xe.NO_AD]:()=>{Gi(Me.NO_AD,s)},[Xe.COLLAPSED]:()=>{Gi(Me.POSITION_COLLAPSED,s)},[Xe.AD_SIZE_CHANGED]:e=>{const t=Object.assign({},s,e.meta);Gi(Me.AD_SIZE_CHANGED,t)},[Xe.AD_MESSAGE]:e=>{const t=Object.assign({},s,e.meta);Gi(Me.AD_MESSAGE,t)},[Xe.DESTROY]:()=>{Ii.isPositionRegistered(t)&&Ii.unsubscribe(i),o("off"),delete this._positionComponents[t]},[Xe.AD_CLOSED]:()=>{Gi(Me.AD_CLOSED,s)},[Xe.AD_OPENED]:()=>{Gi(Me.AD_OPENED,s)}},o=e=>Object.keys(n).forEach((t=>i[e](t,n[t])));return o("on"),Ii.isPositionRegistered(t)&&Ii.subscribe(i),i},destroyPosition(e){const t=this._positionComponents[e];t&&t.destroy();const i=this._positions[e];i&&(i.off(me.CONFIG_UPDATE,ji),Ii.isPositionRegistered(e)&&Ii.deregister(i),this.abort([e]),this._config.removePosition(e),delete this._positions[e],delete Di[e])},fetch(e){if(!this._config)return void X.warning("JAC Config has not been set.");if(!this._config.isServiceConfigValid())return void X.warning("JAC Config has missing/invalid information.");g.isSet(e)||(e=Object.keys(this._positions));const{result:t,validPositionNames:i}=ki("fetch",e,(e=>{const t=this._positions[e],i=this._positionComponents[e],s=t.fetch,n=(new Date).getTime(),o=t.config.client.fetch.minInterval;if(s&&(s.isPending(e)||s.endTime+o>n))return X.warning(`JAC.fetch() can only be called once per ${o}ms for ${e} position.`),!1;if(i&&t.config.client.render.auto){const{hasMouseOver:s,isExpanded:n}=i,o=s&&t.config.client.render.abortOnMouseOver,r=n&&t.config.client.render.abortOnExpandedAd;if(o||r)return X.warning(`JAC.fetch() was ignored for position ${e} because `+(s?"the user is interacting with the current ad.":"the current ad is expanded.")),!1}return!0}));if(t){const e=new $e({positionNames:i});i.forEach((t=>{const i=this._positions[t];i.fetch=e,Ii.isPositionRegistered(t)&&Ii.resetRegistration(i)})),Bi(e,this._config)}},render(e){if(!this._config)return void X.warning("JAC Config has not been set.");g.isSet(e)||(e=Object.keys(Di));const{result:t,validPositionNames:i}=ki("render",e,(e=>{const t=this._positions[e];return t&&function(e,t){return Ji(e)?!!t.getTargetElement()||(X.warning(`Target HTML element not found for position ${e}.`),!1):(X.warning(`No ad data for position ${e}.`),!1)}(e,t.config)}));if(t){const e=new Ti({positionNames:i});e.start(),i.forEach((t=>{this._positions[t].render=e})),Gi(Me.RENDER_START,{positionNames:i}),i.forEach((e=>{const t=this._positions[e];this._positionComponents[e]||(this._positionComponents[e]=this._createPositionComponent(t)),this._positionComponents[e].render(),delete Di[e]}))}},abort(e){g.isSet(e)||(e=Object.keys(this._positions));const{result:t,validPositionNames:i}=ki("abort",e);t&&i.forEach((e=>{const t=this._positions[e],i=t.fetch;i&&i.isPending(e)&&(i.abortPosition(e),t.fetch=null);const s=t.render;if(s&&s.isPending(e)){s.abortPosition(e),t.render=null;const i=this._positionComponents[e];i&&i.abortRender()}}))},clear(e){g.isSet(e)||(e=Object.keys(this._positions));const{result:t,validPositionNames:i}=ki("clear",e);t&&i.forEach((e=>{const t=this._positionComponents[e];t&&t.clearAd()}))},isPositionPending(e){const t=this._positions[e];return!(!t||!(t.fetch&&t.fetch.isPending(e)||t.render&&t.render.isPending(e)))},getPending(){return Object.keys(this._positions).filter((e=>this.isPositionPending(e)))},isPositionFetched:e=>Ji(e),getFetched:()=>Object.keys(Di).filter((e=>Ji(e))),updateMeta(e,t,i,s){if(!t||g.isString(t)&&!i)return void X.warning("Invalid meta was provided.");const{result:n,validPositionNames:o}=ki("updateMeta",e);n&&o.forEach((e=>{this._positions[e].updateMeta(t,i,s)}))}};function Xi(e){Object.keys(e).forEach((t=>{const i=e[t],s=Yi._positions[t];if(s.applyAdData(i),!s.rotated&&s.config.client.rotation.enabled&&(Object.prototype.hasOwnProperty.call(Yi._config.service.adServer,ie.RAS)||Object.prototype.hasOwnProperty.call(Yi._config.service.adServer,ie["1AS"]))){const e=Fi.createRotationConfig(s.config,i);s.updateRotationConfig(e)}Di[t]=i}))}function qi(){Yi._config.setRegulatoryData(Li),Ni.resolve(Yi._config)}function Ki(){Yi._config.setUserIdentity(Ni)}Object.assign(Yi,f);const Qi=Yi;window!==window.top&&"undefined"==typeof JAC_CONFIG?function(e){if(!function(e){const t=[/^.*yahoosandbox\.com$/,/^.*localhost(:\d+)?$/];if(!De(e)){const i=e.location.host;return t.filter((e=>i.match(e))).length>0}try{return!e.frameElement.src}catch(e){return!0}}(e))return void X.error("Invalid context detected");const{token:t,adMarkup:i,size:n,detectSize:o,allowedSizes:r,position:a,safeFrameData:c}=function(e){const t=e.name;if(!t)throw Error("No data provided for the position sandbox.");e.name="";try{e.frameElement.removeAttribute("name")}catch(e){}let i,s,n;try{const e=JSON.parse(t);i=e.token,s=e.adData,n=e.safeFrame}catch(e){throw Error("Invalid data provided for the position sandbox.")}if(!i)throw Error("Missing sandbox token.");if(!s||!s.content)throw Error("Missing sandbox ad data.");if(!s.content.markup&&s.status===ne)throw Error("Missing sandbox ad markup.");if(s.content.markup||X.warning("Missing sandbox ad markup."),!s.content.size||!s.content.size.width||!s.content.size.height)throw Error("Missing sandbox ad size.");if(!s.config||!s.config.service||!s.config.client)throw Error("Missing sandbox position config.");const o=s.config.service.sizes,r=o?o.map((e=>{const[t,i]=e.split("x");return{width:parseInt(t),height:parseInt(i)}})):[],a=s.status!==oe&&!k.isMobileMomentAd(s)&&(!s.meta||!s.meta.aolSize)&&r.length>1,c=new Ae("",s.config);return c.updateContainerType(s.meta||{}),{token:i,adMarkup:s.content.markup,size:s.content.size,detectSize:a,allowedSizes:r,position:c,safeFrameData:n}}(e),l=a.config;we=o,Oe(t,e,l.client.nestedIframe),function(e,t){e.JAC={version:"string"!==d?"1.5.0":"0.0.0",sandbox:new H(Ce,t)}}(e,l),e.JAC.sandbox.on(z.INIT_CALLED,(t=>{we=!1,be(a,!!t.meta.ratio,e)})),a.containerType===ae.SAFE_FRAME&&function(e,t,i){Ce.listen(),e.$sf={ext:new ee(Ce,t,i,e)},e.Y={SandBox:{vendor:new te(Ce)}}}(e,l,c),be(a,!1,e),s.addPageLoadListener((()=>ve({positionConfig:l,initialWidth:n.width,initialHeight:n.height,allowedSizes:r}))),function(e,t){e.document.write(`<div>${t}</div>`)}(e,i),Ce.send(new C({topic:C.topic.WRITE_COMPLETE}))}(window):(Object.assign(Qi,{PageObserver:A,PageEvent:t}),window.JAC=Qi,function(e){Ri.on(je.RESPONSE_PROCESSED,(e=>{const t=e.meta.response,i=e.meta.fetchAction;i.end();const s=vi.createFromJillResponse(i.completedPositionNames,t,Yi._config),n=Object.keys(s);Xi(s),Gi(Me.FETCH_COMPLETE,{positionNames:n,response:{positions:s,adServer:t.adServer,service:t.service}}),Pi.domLoaded&&Zi(n)})),Ri.on(je.FETCH_TIMEOUT,(e=>{const t=vi.createFromTimeout(e.meta.positionNames,Yi._config),i=Object.keys(t);Xi(t),Gi(Me.FETCH_TIMEOUT,e.meta),Pi.domLoaded&&Zi(i)})),Ri.on(je.FETCH_ERROR,(e=>{Gi(Me.FETCH_ERROR,e.meta)})),Ii.init(),Ii.on(Tt.ROTATION,(e=>{const t=e.meta.positionNames,i=new $e({positionNames:t});t.forEach((e=>{const t=Yi._positions[e],s=Yi._positionComponents[e].lastAdSize;t.rotated||(t.rotated=!0,t.alias=Fi.getRotationAliasBasedOnSize(t.adData,s)),i.optionsPerPosition[e]={fetchSize:s,allowedSizes:t.adData.config.service.sizes},t.fetch=i,Gi(Me.POSITION_ROTATE,{positionName:e})})),Bi(i,Yi._config)})),Li.on(Nt.API_NOT_FOUND,qi),Li.on(Nt.RESOLVED,qi),Li.on(Nt.READ_TIMEOUT,qi),Li.on(Nt.UPDATED,qi),Ni.on(ti.RESOLVED,Ki),Ni.on(ti.TIMEOUT,Ki),Ni.on(ti.UPDATED,Ki),xi.activate(e,Yi),Mi.init(Yi),function(e){const t=e.document,i="currentScript"in t?t.currentScript:t.querySelector("script[data-jac-ssc]");try{const e=i&&i.dataset.jacSsc;e&&(Yi._serverSideConfig=JSON.parse(e))}catch(e){X.error("Error processing server-side config",e)}}(e),function(e){e.JAC_CONFIG&&Yi.setConfig(e.JAC_CONFIG),Yi._globalConfigProcessed=!0}(e),Pi.on(t.DOM_LOADED,(()=>{Zi(Object.keys(Yi._adData))})),Pi.on(t.LOADED,(()=>{Ui.injectTrackers(Yi._config?Yi._config.client.trackers:null)}))}(window))})()})();