!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("wafer-jac",[],t):"object"==typeof exports?exports["wafer-jac"]=t():(e.wafer=e.wafer||{},e.wafer.wafers=e.wafer.wafers||{},e.wafer.wafers["wafer-jac"]=t())}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="https://s.yimg.com/aaq/wf/",t(t.s="./src/entry.js")}({"./src/entry.js":function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),d=window.wafer,p=d.constants,v=d.WaferBaseClass,h=p.ATTR_PREFIX,y=["darla-config","jac-config"],w=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.errorClass,a=r.selector,s=r.successClass;n(this,t);var c=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{errorClass:i,selector:a,successClass:s},{STATE_ATTRS:y})),l=(e.getAttribute(h+"margin")||"").split(" "),d=f(l,2),p=d[0],v=void 0===p?"1200":p,w=d[1],g=void 0===w?"0":w;return c._util=u({},c._util,{"jac-config":e.getAttribute(h+"jac-config"),offsetX:Number(g)||0,offsetY:Number(v)||0,trigger:e.getAttribute(h+"trigger")||"viewport"}),c}return i(t,e),l(t,[{key:"stateDidUpdate",value:function(){this._stateDidUpdate()}},{key:"config",get:function(){var e=this._util;return{offsetX:e.offsetX,offsetY:e.offsetY,trigger:e.trigger}}}]),t}(v);w.events={};var g=w,b=function(){function e(e,t){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},j=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},E=window.wafer.controllers.WaferBaseController,O=window.wafer,C=O.base,A=O.utils,x=A.elementInView,P=A.debounce,k=A.get,T=A.getUrlParameterValueByName,I={autoIV:1,autoMax:25,autoRT:"10000"},F=["defaultDest","jacPosition","parent-sdaAdvText-","sdaAdvText-","wafer-jac-","wafer-jac-clean-"],R=["300x250"],S=function(e){var t=e.height,r=e.size,n=e.width;return t&&n?[n+"x"+t]:r&&r.length>0?r:R},J=function(e,t){var r=e.length;if(t+1<r){for(var n=e.charAt(t+1),o=!1;" "===n&&t+1<r;)t++,n=e.charAt(t),o=!0;o&&t--}return t},N=function(e,t,r,n){var o=t.length;if(r+1<o){var i=t.charAt(r+1);for(r++;i!==e&&r+1<o;)"\\"!==i&&(n+=i),i=t.charAt(r+1),r++;i!==e&&(n+=i)}return{curTok:n,index:r}},D=function(e){if(!e)return null;var t="",r=[],n=0,o="";for(n=0;n<e.length;n++)if("="===(o=e.charAt(n)))t&&(r.push(t),t=""),n=J(e,n);else if('"'===o){t&&(r.push(t),t="");var i=N('"',e,n,t),a=i.curTok,s=i.index;t=a,n=s,t&&(r.push(t),t="")}else if("'"===o){t&&(r.push(t),t="");var c=N("'",e,n,t),u=c.curTok,f=c.index;t=u,n=f,t&&(r.push(t),t="")}else if(" "===o)t&&(r.push(t),t=""),n=J(e,n);else{if("\\"===o)continue;t+=o}t&&(r.push(t),t="");var l={},d=r.length;for(n=0;n<d;n+=2)l[r[n]]=r[n+1];return d%2==1&&(l[r[d-1]]=" "),l},L=function(e){function t(e){var r=e.errorClass,n=void 0===r?"wafer-jac-error":r,o=e.root,i=void 0===o?document:o,c=e.selector,u=void 0===c?".wafer-jac":c,f=e.successClass,l=void 0===f?"wafer-jac-done":f,d=e.validateDelay,p=void 0===d?25:d;a(this,t);var v=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{root:i,selector:u,props:{errorClass:n,selector:u,successClass:l},WaferClass:g}));v._validateWithDebounce=P(function(){v.validate()},p,v),v._state=m({addedListenerForJACEvents:null,positionsAddingMap:new Map},v._state);var h=v;return g.prototype._stateDidUpdate=function(){var e=this._util.elem,t=this.config,r=t.offsetX,n=t.offsetY,o=t.trigger,i=!1;(i="viewport"!==o||x(e,{offsetX:r,offsetY:n},C.viewport))&&h.triggerForElements([e],{source:"state"})},v.sync(),v}return c(t,e),j(t,[{key:"_checkIfJACNameSpaceExist",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(r,n){if(t>5)return n(new Error("namespace does not exist"));if(window.JAC)return r();var o=t+1;setTimeout(function(){e._checkIfJACNameSpaceExist(o).then(function(){r()}).catch(function(e){n(e)})},50*o)})}},{key:"_handlePositionFailure",value:function(e,t){var r=document.getElementsByClassName("wafer-jac-pos-"+e)[0];if(r){var n=this._state.elementInstances.get(r),o=n.instance;o&&o.destroy(),r.classList.remove("wafer-jac-in-progress"),C.emitWaferEvent("jac:error",{elem:r,meta:{data:t,positionName:e}})}}},{key:"jacRenderComplete",value:function(e){var t=e.meta,r="wafer-jac-pos-"+t.positionNames.join(","),n=document.getElementById(r);if(n){var o=this._state.elementInstances.get(n),i=o.instance;i&&i.destroy(),n.classList.remove("wafer-jac-in-progress"),C.emitWaferEvent("jac:success",{elem:n,meta:{data:t,id:r}})}}},{key:"jacPositionError",value:function(e){var t=e.meta;this._handlePositionFailure(t.positionName,t)}},{key:"jacFetchError",value:function(e){var t=this,r=e.meta;r.positionNames.ForEach(function(e){t._handlePositionFailure(e,r)})}},{key:"listenToJACEvents",value:function(){var e=this._state;if(!e.addedListenerForJACEvents){e.addedListenerForJACEvents=!0;var t=window.JAC;t.on("POSITION_RENDER_FAILED",this.jacPositionError.bind(this)),t.on("RENDER_COMPLETE",this.jacRenderComplete.bind(this)),t.on("FETCH_ERROR",this.jacFetchError.bind(this)),t.on("FETCH_TIMEOUT",this.jacFetchError.bind(this))}}},{key:"updateElemId",value:function(e,t,r,n){t&&this.updateElemId(e,"",r,n),F.forEach(function(o){var i=e.querySelector("#"+o+(t+r));i&&(i.classList.add("wafer-jac-id-updated"),i.setAttribute("id",""+o+(t+n)))})}},{key:"getUpdatedPos",value:function(e){var t=this._state.positionsAddingMap;return e.split(",").map(function(e){var r=e.split("-"),n=b(r,1),o=n[0],i=t.get(o)||1,a=i+1;a>=10&&(a=1);var s=o+"-"+i;return t.set(o,a),s}).join(",")}},{key:"makeJacCall",value:function(e,t,r,n){var o=this,i=r.enabled,a=void 0===i||i,s=k(window,["YAHOO","subscriptions","adLite"]);if(a&&!n.classList.contains("wafer-jac-in-progress")&&!s){var c=r.addAutoEvent,u=void 0!==c&&c,f=r.authed,l=void 0===f?"0":f,d=r.bucket,p=void 0===d?"testBucket":d,v=r.includeRapidKey,h=void 0!==v&&v,y=r.meta,w=void 0===y?{size:R}:y,g=r.site,b=void 0===g?"fp":g,m=r.uuid,j=r.siteAttribute,_=void 0===j?{}:j,E=window.JAC;if(n.classList.add("wafer-jac-in-progress"),e&&t&&E){var O=window.wafer.base||{},C=O.pageContext,A=window.location.href,x="";C.ynet&&(t=T("_spaceid",A)||t,x=T("atwKV",A)||x);var P={"Y-BUCKET":p};"string"==typeof _?Object.assign(P,D(_)):P=_;var F=window.rapidInstance,J=F&&F.getRapidAttribute;if(h&&J){var N=J("keys")||{},L=N.pd,Y=void 0===L?"":L,M=N.pt,U=void 0===M?"":M,V=N.ver,W=void 0===V?"":V,X=P.rs||"";if(-1===X.indexOf("pd:")&&(X+=";pd:"+Y),-1===X.indexOf("pt:")&&(X+=";pt:"+U),-1===X.indexOf("ver:")&&(X+=";ver:"+W),-1===X.indexOf("lu:")){X+=";lu:"+(C.authed||l)}P.rs=X}x&&(P.atwKV=x),void 0===P.ctout&&(P.ctout="380");var B=E.getConfig(),z={service:{adServer:{PG:{siteAttributes:P}},site:{name:b,spaceId:t}},client:{fetch:{auto:!1},render:{auto:!0},safeFrame:{enabled:!0,features:{expandOver:{enabled:!0}}}}};if(void 0===B)E.setConfig(z);else{var K=B.service,q=K&&K.positions;if(0===(q&&Object.keys(q)).length)E.setConfig(Object.assign({},B,z));else if(K){var G=K.adServer.PG.siteAttributes||{};E.updateConfig("service.adServer.PG.siteAttributes",Object.assign({},G,P)),E.updateConfig("service.site",{name:b,spaceId:t})}}var H=e.split(",");e=this.getUpdatedPos(e);var Q=e.split(",");Q.forEach(function(e,t){var r=H[t],i=w[r]||w[e]||{},a=S(i),s=m?m+"-":"",c=i.targetElement||"defaultDest"+s+e,f={service:{id:e.split("-")[0],size:a},client:{targetElement:c,fetch:{auto:!1},render:{auto:!0},safeFrame:{enabled:!0,features:{expandOver:{enabled:!0}}}}};u&&(f.client.rotation={enabled:!0,inViewDuration:I.autoRT,limit:I.autoMax,period:I.autoRT,requireViewable:!0}),o.updateElemId(n,s,r,e),n.classList.add("wafer-jac-pos-"+e),E.createPosition(e,f)}),n.setAttribute("id","wafer-jac-pos-"+Q),E.fetch(Q)}}}},{key:"triggerForElements",value:function(e){var t=this;this._checkIfJACNameSpaceExist().then(function(){t.listenToJACEvents();var r=window.JAC,n=t._state.elementInstances;r&&e.some(function(e){var o=n.get(e),i=o.instance,a={};try{if(!(a=JSON.parse(i._util["jac-config"])))return!1;a.retryCount=0;var s=a,c=s.pos,u=s.spaceid;c&&u&&r&&t.makeJacCall(c,u,a,e)}catch(r){e.classList.add(t._options.props.errorClass),i.destroy()}})}).catch(function(){})}},{key:"handleScroll",value:function(){this._validateWithDebounce()}},{key:"handleResize",value:function(){this._validateWithDebounce()}},{key:"willValidate",value:function(e){var t=[],r=this._state.elementInstances;e.forEach(function(e){var n=r.get(e),o=n.instance,i=o.config,a=i.offsetX,s=i.offsetY,c=i.trigger;"viewport"===c&&x(e,{offsetX:a,offsetY:s},C.viewport)?t.push(e):"onScroll"===c&&window.scrollY>2?t.push(e):"onLoad"===c&&t.push(e)}),t.length&&this.triggerForElements(t)}},{key:"destroy",value:function(e){_(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this,e)}}]),t}(E),Y=L;t.default=new Y({selector:"wafer-jac"})}})});